<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><meta name="description" content="When dealing with metabolomics results, it is often necessary to filter
features based on certain criteria. These criteria are typically derived
from statistical formulas applied to full rows of data, where each row
represents a feature and its abundance of signal in each samples.
The filterFeatures function filters features based on these conventional
quality assessment criteria. Multiple types of filtering are implemented and
can be defined by the filter argument.
Supported filter arguments are:
RsdFilter: Calculates the relative standard deviation
(i.e. coefficient of variation) in abundance for each feature in QC
(Quality Control) samples and filters them in the input object according to
a provided threshold.
DratioFilter: Computes the D-ratio or dispersion ratio, defined as
the standard deviation in abundance for QC samples divided by the standard
deviation for biological test samples, for each feature and filters them
according to a provided threshold.
PercentMissingFilter: Determines the percentage of missing values for
each feature in the various sample groups and filters them according to a
provided threshold.
BlankFlag: Identifies features where the mean abundance in test samples
is lower than a specified multiple of the mean abundance of blank samples.
This can be used to flag features that result from contamination in the
solvent of the samples. A new column possible_contaminants is added to the
featureDefinitions (XcmsExperiment object) or rowData
(SummarizedExperiment object) reflecting this.


For specific examples, see the help pages of the individual parameter classes
listed above."><title>Filtering of features based on conventional quality assessment — filterFeatures • xcms</title><!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png"><link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png"><link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png"><link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png"><link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png"><link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png"><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous"><!-- bootstrap-toc --><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@v1.0.1/dist/bootstrap-toc.min.js" integrity="sha256-4veVQbu7//Lk5TSmc7YV48MxtMy98e26cf5MrgZYnwo=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Filtering of features based on conventional quality assessment — filterFeatures"><meta property="og:description" content="When dealing with metabolomics results, it is often necessary to filter
features based on certain criteria. These criteria are typically derived
from statistical formulas applied to full rows of data, where each row
represents a feature and its abundance of signal in each samples.
The filterFeatures function filters features based on these conventional
quality assessment criteria. Multiple types of filtering are implemented and
can be defined by the filter argument.
Supported filter arguments are:
RsdFilter: Calculates the relative standard deviation
(i.e. coefficient of variation) in abundance for each feature in QC
(Quality Control) samples and filters them in the input object according to
a provided threshold.
DratioFilter: Computes the D-ratio or dispersion ratio, defined as
the standard deviation in abundance for QC samples divided by the standard
deviation for biological test samples, for each feature and filters them
according to a provided threshold.
PercentMissingFilter: Determines the percentage of missing values for
each feature in the various sample groups and filters them according to a
provided threshold.
BlankFlag: Identifies features where the mean abundance in test samples
is lower than a specified multiple of the mean abundance of blank samples.
This can be used to flag features that result from contamination in the
solvent of the samples. A new column possible_contaminants is added to the
featureDefinitions (XcmsExperiment object) or rowData
(SummarizedExperiment object) reflecting this.


For specific examples, see the help pages of the individual parameter classes
listed above."><meta property="og:image" content="https://sneumann.github.io/xcms/logo.png"><!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-dark navbar-expand-lg bg-primary" data-bs-theme="dark"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">xcms</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">4.1.9</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="nav-item">
  <a class="nav-link" href="../articles/xcms.html">Get started</a>
</li>
<li class="active nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
<li class="nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-articles">Articles</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-articles">
    <a class="dropdown-item" href="../articles/LC-MS-feature-grouping.html">Compounding (grouping) of LC-MS features</a>
    <a class="dropdown-item" href="../articles/xcms-direct-injection.html">Grouping FTICR-MS data with xcms</a>
    <a class="dropdown-item" href="../articles/xcms-lcms-ms.html">LC-MS/MS data analysis with xcms</a>
  </div>
</li>
      </ul><form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off"></form>

      <ul class="navbar-nav"><li class="nav-item">
  <a class="external-link nav-link" href="https://github.com/sneumann/xcms/" aria-label="github">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul></div>

    
  </div>
</nav><div class="container template-reference-topic">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>Filtering of features based on conventional quality assessment</h1>
      <small class="dont-index">Source: <a href="https://github.com/sneumann/xcms/blob/HEAD/R/method-filterFeatures.R" class="external-link"><code>R/method-filterFeatures.R</code></a></small>
      <div class="d-none name"><code>filterFeatures.Rd</code></div>
    </div>

    <div class="ref-description section level2">
    <p>When dealing with metabolomics results, it is often necessary to filter
features based on certain criteria. These criteria are typically derived
from statistical formulas applied to full rows of data, where each row
represents a feature and its abundance of signal in each samples.
The <code>filterFeatures</code> function filters features based on these conventional
quality assessment criteria. Multiple types of filtering are implemented and
can be defined by the <code>filter</code> argument.</p>
<p>Supported <code>filter</code> arguments are:</p><ul><li><p><code><a href="RsdFilter.html">RsdFilter</a></code>: Calculates the relative standard deviation
(i.e. coefficient of variation) in abundance for each feature in QC
(Quality Control) samples and filters them in the input object according to
a provided threshold.</p></li>
<li><p><code><a href="DratioFilter.html">DratioFilter</a></code>: Computes the D-ratio or <em>dispersion ratio</em>, defined as
the standard deviation in abundance for QC samples divided by the standard
deviation for biological test samples, for each feature and filters them
according to a provided threshold.</p></li>
<li><p><code><a href="PercentMissingFilter.html">PercentMissingFilter</a></code>: Determines the percentage of missing values for
each feature in the various sample groups and filters them according to a
provided threshold.</p></li>
<li><p><code><a href="BlankFlag.html">BlankFlag</a></code>: Identifies features where the mean abundance in test samples
is lower than a specified multiple of the mean abundance of blank samples.
This can be used to flag features that result from contamination in the
solvent of the samples. A new column <code>possible_contaminants</code> is added to the
<code>featureDefinitions</code> (<code>XcmsExperiment</code> object) or <code>rowData</code>
(<code>SummarizedExperiment</code> object) reflecting this.</p></li>
</ul><p>For specific examples, see the help pages of the individual parameter classes
listed above.</p>
    </div>


    <div class="section level2">
    <h2 id="arguments">Arguments<a class="anchor" aria-label="anchor" href="#arguments"></a></h2>
    <dl><dt>object</dt>
<dd><p><code>XcmsExperiment</code> or <code>SummarizedExperiment</code>. For an
<code>XcmsExperiment</code> object, the <code>featureValues(object)</code> will be evaluated, and
for <code>Summarizedesxperiment</code> the <code>assay(object, assay)</code>. The object will be
filtered.</p></dd>


<dt>filter</dt>
<dd><p>The parameter object selecting and configuring the type of
filtering. It can be one of the following classes: <code><a href="RsdFilter.html">RsdFilter</a></code>,
<code><a href="DratioFilter.html">DratioFilter</a></code>, <code><a href="PercentMissingFilter.html">PercentMissingFilter</a></code> or <code><a href="BlankFlag.html">BlankFlag</a></code>.</p></dd>


<dt>assay</dt>
<dd><p>For filtering of <code>SummarizedExperiment</code> objects only. Indicates
which assay the filtering will be based on. Note that the features for the
entire object will be removed, but the computations are performed on a single
assay. Default is 1, which means the first assay of the <code>object</code> will
be evaluated.</p></dd>


<dt>...</dt>
<dd><p>Optional parameters. For <code>object</code> being an <code>XcmsExperiment</code>:
parameters for the <code><a href="XCMSnExp-peak-grouping-results.html">featureValues()</a></code> call.</p></dd>

</dl></div>
    <div class="section level2">
    <h2 id="references">References<a class="anchor" aria-label="anchor" href="#references"></a></h2>
    <p>Broadhurst D, Goodacre R, Reinke SN, Kuligowski J, Wilson ID, Lewis MR,
Dunn WB. Guidelines and considerations for the use of system suitability
and quality control samples in mass spectrometry assays applied in
untargeted clinical metabolomic studies. Metabolomics. 2018;14(6):72.
doi: 10.1007/s11306-018-1367-3. Epub 2018 May 18. PMID: 29805336;
PMCID: PMC5960010.</p>
    </div>
    <div class="section level2">
    <h2 id="author">Author<a class="anchor" aria-label="anchor" href="#author"></a></h2>
    <p>Philippine Louail</p>
    </div>

    <div class="section level2">
    <h2 id="ref-examples">Examples<a class="anchor" aria-label="anchor" href="#ref-examples"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span><span class="co">## See the vignettes for more detailed examples</span></span></span>
<span class="r-in"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/RforMassSpectrometry/MsExperiment" class="external-link">MsExperiment</a></span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">## Load a test data set with features defined.</span></span></span>
<span class="r-in"><span><span class="va">test_xcms</span> <span class="op">&lt;-</span> <span class="fu"><a href="loadXcmsData.html">loadXcmsData</a></span><span class="op">(</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="co">## Set up parameter to filter based on coefficient of variation. By setting</span></span></span>
<span class="r-in"><span><span class="co">## the filter such as below, features that have a coefficient of variation</span></span></span>
<span class="r-in"><span><span class="co">## superior to 0.3 in QC samples will be removed from the object `test_xcms`</span></span></span>
<span class="r-in"><span><span class="co">## when calling the `filterFeatures` function.</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="va">rsd_filter</span> <span class="op">&lt;-</span> <span class="fu"><a href="RsdFilter.html">RsdFilter</a></span><span class="op">(</span>threshold <span class="op">=</span> <span class="fl">0.3</span>,</span></span>
<span class="r-in"><span>                        qcIndex <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/MsExperiment/man/MsExperiment.html" class="external-link">sampleData</a></span><span class="op">(</span><span class="va">test_xcms</span><span class="op">)</span><span class="op">$</span><span class="va">sample_type</span> <span class="op">==</span> <span class="st">"QC"</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="va">filtered_data_rsd</span> <span class="op">&lt;-</span> <span class="fu">filterFeatures</span><span class="op">(</span>object <span class="op">=</span> <span class="va">test_xcms</span>, filter <span class="op">=</span> <span class="va">rsd_filter</span><span class="op">)</span></span></span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> 262 features were removed</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">## Set up parameter to filter based on D-ratio. By setting the filter such</span></span></span>
<span class="r-in"><span><span class="co">## as below, features that have a D-ratio computed based on their abundance</span></span></span>
<span class="r-in"><span><span class="co">## between QC and study samples superior to 0.5 will be removed from the</span></span></span>
<span class="r-in"><span><span class="co">## object `test_xcms`.</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="va">dratio_filter</span> <span class="op">&lt;-</span> <span class="fu"><a href="DratioFilter.html">DratioFilter</a></span><span class="op">(</span>threshold <span class="op">=</span> <span class="fl">0.5</span>,</span></span>
<span class="r-in"><span>                 qcIndex <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/MsExperiment/man/MsExperiment.html" class="external-link">sampleData</a></span><span class="op">(</span><span class="va">test_xcms</span><span class="op">)</span><span class="op">$</span><span class="va">sample_type</span> <span class="op">==</span> <span class="st">"QC"</span>,</span></span>
<span class="r-in"><span>                 studyIndex <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/MsExperiment/man/MsExperiment.html" class="external-link">sampleData</a></span><span class="op">(</span><span class="va">test_xcms</span><span class="op">)</span><span class="op">$</span><span class="va">sample_type</span> <span class="op">==</span> <span class="st">"study"</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="va">filtered_data_dratio</span> <span class="op">&lt;-</span> <span class="fu">filterFeatures</span><span class="op">(</span>object <span class="op">=</span> <span class="va">test_xcms</span>,</span></span>
<span class="r-in"><span>                                       filter <span class="op">=</span> <span class="va">dratio_filter</span><span class="op">)</span></span></span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> 241 features were removed</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">## Set up parameter to filter based on the percent of missing data.</span></span></span>
<span class="r-in"><span><span class="co">## Parameter f should represent the sample group of samples, for which the</span></span></span>
<span class="r-in"><span><span class="co">## percentage of missing values will be evaluated. As the setting is defined</span></span></span>
<span class="r-in"><span><span class="co">## bellow, if a feature as less (or equal) to 30% missing values in one</span></span></span>
<span class="r-in"><span><span class="co">## sample group, it will be kept in the `test_xcms` object.</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="va">missing_data_filter</span> <span class="op">&lt;-</span> <span class="fu"><a href="PercentMissingFilter.html">PercentMissingFilter</a></span><span class="op">(</span>threshold <span class="op">=</span> <span class="fl">30</span>,</span></span>
<span class="r-in"><span>                                       f <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/MsExperiment/man/MsExperiment.html" class="external-link">sampleData</a></span><span class="op">(</span><span class="va">test_xcms</span><span class="op">)</span><span class="op">$</span><span class="va">sample_type</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="va">filtered_data_missing</span> <span class="op">&lt;-</span> <span class="fu">filterFeatures</span><span class="op">(</span>object <span class="op">=</span> <span class="va">test_xcms</span>,</span></span>
<span class="r-in"><span>                                        filter <span class="op">=</span> <span class="va">missing_data_filter</span><span class="op">)</span></span></span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> 6 features were removed</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">## Set up parameter to flag possible contaminants based on blank samples'</span></span></span>
<span class="r-in"><span><span class="co">## abundance. By setting the filter such as below, features that have mean</span></span></span>
<span class="r-in"><span><span class="co">## abundance ratio between blank(here use study as an example) and QC</span></span></span>
<span class="r-in"><span><span class="co">## samples less than 2 will be marked as `TRUE` in an extra column named</span></span></span>
<span class="r-in"><span><span class="co">## `possible_contaminants` in the `featureDefinitions` table of the object</span></span></span>
<span class="r-in"><span><span class="co">## `test_xcms`.</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="va">filter</span> <span class="op">&lt;-</span> <span class="fu"><a href="BlankFlag.html">BlankFlag</a></span><span class="op">(</span>threshold <span class="op">=</span> <span class="fl">2</span>,</span></span>
<span class="r-in"><span>                    qcIndex <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/MsExperiment/man/MsExperiment.html" class="external-link">sampleData</a></span><span class="op">(</span><span class="va">test_xcms</span><span class="op">)</span><span class="op">$</span><span class="va">sample_type</span> <span class="op">==</span> <span class="st">"QC"</span>,</span></span>
<span class="r-in"><span>                    blankIndex <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/MsExperiment/man/MsExperiment.html" class="external-link">sampleData</a></span><span class="op">(</span><span class="va">test_xcms</span><span class="op">)</span><span class="op">$</span><span class="va">sample_type</span> <span class="op">==</span> <span class="st">"study"</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">filtered_xmse</span> <span class="op">&lt;-</span> <span class="fu">filterFeatures</span><span class="op">(</span><span class="va">test_xcms</span>, <span class="va">filter</span><span class="op">)</span></span></span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> -13 features were flagged</span>
<span class="r-in"><span></span></span>
</code></pre></div>
    </div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p></p><p>Developed by Colin A. Smith, Ralf Tautenhahn, Steffen Neumann, Paul Benton, Christopher Conley, Johannes Rainer, William Kumler, Philippine Louail.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p><p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.9000.</p>
</div>

    </footer></div>

  

  

  </body></html>

