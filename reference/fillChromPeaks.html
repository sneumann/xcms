<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><meta name="description" content="Gap filling integrate signal in the m/z-rt area of a feature (i.e., a
chromatographic peak group) for samples in which no chromatographic
peak for this feature was identified and add it to the chromPeaks()
matrix. Such filled-in peaks are indicated with a TRUE in column
&quot;is_filled&quot; in the result object's chromPeakData() data frame.
The method for gap filling along with its settings can be defined with
the param argument. Two different approaches are available:
param = FillChromPeaksParam(): the default of the original xcms
code. Signal is integrated from the m/z and retention time range as
defined in the featureDefinitions() data frame, i.e. from the
&quot;rtmin&quot;, &quot;rtmax&quot;, &quot;mzmin&quot; and &quot;mzmax&quot;. This method is not
suggested as it underestimates the actual peak area and it is also
not available for object being an XcmsExperiment object. See
details below for more information and settings for this method.
param = ChromPeakAreaParam(): the area from which the signal for a
feature is integrated is defined based on the feature's chromatographic
peak areas. The m/z range is by default defined as the the lower quartile
of chromatographic peaks' &quot;mzmin&quot; value to the upper quartile of the
chromatographic peaks' &quot;mzmax&quot; values. The retention time range for the
area is defined analogously. Alternatively, by setting mzmin = median,
mzmax = median, rtmin = median and rtmax = median in
ChromPeakAreaParam, the median &quot;mzmin&quot;, &quot;mzmax&quot;, &quot;rtmin&quot; and
&quot;rtmax&quot; values from all detected chromatographic peaks of a feature
would be used instead.
In contrast to the  FillChromPeaksParam approach this method uses the
actual identified chromatographic peaks of a feature to define the area
from which the signal should be integrated.


expandMz,expandMz&amp;lt;-: getter and setter
    for the expandMz slot of the object.
expandRt,expandRt&amp;lt;-: getter and setter
    for the expandRt slot of the object.
ppm,ppm&amp;lt;-: getter and setter
    for the ppm slot of the object."><title>Gap Filling — fillChromPeaks • xcms</title><!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png"><link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png"><link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png"><link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png"><link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png"><link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png"><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous"><!-- bootstrap-toc --><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@v1.0.1/dist/bootstrap-toc.min.js" integrity="sha256-4veVQbu7//Lk5TSmc7YV48MxtMy98e26cf5MrgZYnwo=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Gap Filling — fillChromPeaks"><meta property="og:description" content="Gap filling integrate signal in the m/z-rt area of a feature (i.e., a
chromatographic peak group) for samples in which no chromatographic
peak for this feature was identified and add it to the chromPeaks()
matrix. Such filled-in peaks are indicated with a TRUE in column
&quot;is_filled&quot; in the result object's chromPeakData() data frame.
The method for gap filling along with its settings can be defined with
the param argument. Two different approaches are available:
param = FillChromPeaksParam(): the default of the original xcms
code. Signal is integrated from the m/z and retention time range as
defined in the featureDefinitions() data frame, i.e. from the
&quot;rtmin&quot;, &quot;rtmax&quot;, &quot;mzmin&quot; and &quot;mzmax&quot;. This method is not
suggested as it underestimates the actual peak area and it is also
not available for object being an XcmsExperiment object. See
details below for more information and settings for this method.
param = ChromPeakAreaParam(): the area from which the signal for a
feature is integrated is defined based on the feature's chromatographic
peak areas. The m/z range is by default defined as the the lower quartile
of chromatographic peaks' &quot;mzmin&quot; value to the upper quartile of the
chromatographic peaks' &quot;mzmax&quot; values. The retention time range for the
area is defined analogously. Alternatively, by setting mzmin = median,
mzmax = median, rtmin = median and rtmax = median in
ChromPeakAreaParam, the median &quot;mzmin&quot;, &quot;mzmax&quot;, &quot;rtmin&quot; and
&quot;rtmax&quot; values from all detected chromatographic peaks of a feature
would be used instead.
In contrast to the  FillChromPeaksParam approach this method uses the
actual identified chromatographic peaks of a feature to define the area
from which the signal should be integrated.


expandMz,expandMz&amp;lt;-: getter and setter
    for the expandMz slot of the object.
expandRt,expandRt&amp;lt;-: getter and setter
    for the expandRt slot of the object.
ppm,ppm&amp;lt;-: getter and setter
    for the ppm slot of the object."><meta property="og:image" content="https://sneumann.github.io/xcms/logo.png"><!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-dark navbar-expand-lg bg-primary"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">xcms</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">4.1.4</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="nav-item">
  <a class="nav-link" href="../articles/xcms.html">Get started</a>
</li>
<li class="active nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
<li class="nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-articles">Articles</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-articles">
    <a class="dropdown-item" href="../articles/LC-MS-feature-grouping.html">Compounding (grouping) of LC-MS features</a>
    <a class="dropdown-item" href="../articles/xcms-direct-injection.html">Grouping FTICR-MS data with xcms</a>
    <a class="dropdown-item" href="../articles/xcms-lcms-ms.html">LC-MS/MS data analysis with xcms</a>
  </div>
</li>
      </ul><form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off"></form>

      <ul class="navbar-nav"><li class="nav-item">
  <a class="external-link nav-link" href="https://github.com/sneumann/xcms/" aria-label="github">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul></div>

    
  </div>
</nav><div class="container template-reference-topic">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>Gap Filling</h1>
      <small class="dont-index">Source: <a href="https://github.com/sneumann/xcms/blob/HEAD/R/AllGenerics.R" class="external-link"><code>R/AllGenerics.R</code></a>, <a href="https://github.com/sneumann/xcms/blob/HEAD/R/DataClasses.R" class="external-link"><code>R/DataClasses.R</code></a>, <a href="https://github.com/sneumann/xcms/blob/HEAD/R/XcmsExperiment.R" class="external-link"><code>R/XcmsExperiment.R</code></a>, and 3 more</small>
      <div class="d-none name"><code>fillChromPeaks.Rd</code></div>
    </div>

    <div class="ref-description section level2">
    <p>Gap filling integrate signal in the m/z-rt area of a feature (i.e., a
chromatographic peak group) for samples in which no chromatographic
peak for this feature was identified and add it to the <code><a href="XCMSnExp-class.html">chromPeaks()</a></code>
matrix. Such <em>filled-in</em> peaks are indicated with a <code>TRUE</code> in column
<code>"is_filled"</code> in the result object's <code><a href="XCMSnExp-class.html">chromPeakData()</a></code> data frame.</p>
<p>The method for gap filling along with its settings can be defined with
the <code>param</code> argument. Two different approaches are available:</p><ul><li><p><code>param = FillChromPeaksParam()</code>: the default of the original <code>xcms</code>
code. Signal is integrated from the m/z and retention time range as
defined in the <code><a href="XCMSnExp-class.html">featureDefinitions()</a></code> data frame, i.e. from the
<code>"rtmin"</code>, <code>"rtmax"</code>, <code>"mzmin"</code> and <code>"mzmax"</code>. This method is not
suggested as it underestimates the actual peak area and it is also
not available for <code>object</code> being an <a href="XcmsExperiment.html">XcmsExperiment</a> object. See
details below for more information and settings for this method.</p></li>
<li><p><code>param = ChromPeakAreaParam()</code>: the area from which the signal for a
feature is integrated is defined based on the feature's chromatographic
peak areas. The m/z range is by default defined as the the lower quartile
of chromatographic peaks' <code>"mzmin"</code> value to the upper quartile of the
chromatographic peaks' <code>"mzmax"</code> values. The retention time range for the
area is defined analogously. Alternatively, by setting <code>mzmin = median</code>,
<code>mzmax = median</code>, <code>rtmin = median</code> and <code>rtmax = median</code> in
<code>ChromPeakAreaParam</code>, the median <code>"mzmin"</code>, <code>"mzmax"</code>, <code>"rtmin"</code> and
<code>"rtmax"</code> values from all detected chromatographic peaks of a feature
would be used instead.
In contrast to the  <code>FillChromPeaksParam</code> approach this method uses the
actual identified chromatographic peaks of a feature to define the area
from which the signal should be integrated.</p></li>
</ul><p><code>expandMz</code>,<code>expandMz&lt;-</code>: getter and setter
    for the <code>expandMz</code> slot of the object.</p>
<p><code>expandRt</code>,<code>expandRt&lt;-</code>: getter and setter
    for the <code>expandRt</code> slot of the object.</p>
<p><code>ppm</code>,<code>ppm&lt;-</code>: getter and setter
    for the <code>ppm</code> slot of the object.</p>
    </div>

    <div class="section level2">
    <h2 id="ref-usage">Usage<a class="anchor" aria-label="anchor" href="#ref-usage"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">fillChromPeaks</span><span class="op">(</span><span class="va">object</span>, <span class="va">param</span>, <span class="va">...</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># S4 method for XcmsExperiment,ChromPeakAreaParam</span></span>
<span><span class="fu">fillChromPeaks</span><span class="op">(</span></span>
<span>  <span class="va">object</span>,</span>
<span>  <span class="va">param</span>,</span>
<span>  msLevel <span class="op">=</span> <span class="fl">1L</span>,</span>
<span>  chunkSize <span class="op">=</span> <span class="fl">2L</span>,</span>
<span>  BPPARAM <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/BiocParallel/man/register.html" class="external-link">bpparam</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="fu">FillChromPeaksParam</span><span class="op">(</span></span>
<span>  expandMz <span class="op">=</span> <span class="fl">0</span>,</span>
<span>  expandRt <span class="op">=</span> <span class="fl">0</span>,</span>
<span>  ppm <span class="op">=</span> <span class="fl">0</span>,</span>
<span>  fixedMz <span class="op">=</span> <span class="fl">0</span>,</span>
<span>  fixedRt <span class="op">=</span> <span class="fl">0</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="fu">fixedRt</span><span class="op">(</span><span class="va">object</span><span class="op">)</span></span>
<span></span>
<span><span class="fu">fixedMz</span><span class="op">(</span><span class="va">object</span><span class="op">)</span></span>
<span></span>
<span><span class="fu">ChromPeakAreaParam</span><span class="op">(</span></span>
<span>  mzmin <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">z</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/stats/quantile.html" class="external-link">quantile</a></span><span class="op">(</span><span class="va">z</span>, probs <span class="op">=</span> <span class="fl">0.25</span><span class="op">)</span>,</span>
<span>  mzmax <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">z</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/stats/quantile.html" class="external-link">quantile</a></span><span class="op">(</span><span class="va">z</span>, probs <span class="op">=</span> <span class="fl">0.75</span><span class="op">)</span>,</span>
<span>  rtmin <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">z</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/stats/quantile.html" class="external-link">quantile</a></span><span class="op">(</span><span class="va">z</span>, probs <span class="op">=</span> <span class="fl">0.25</span><span class="op">)</span>,</span>
<span>  rtmax <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">z</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/stats/quantile.html" class="external-link">quantile</a></span><span class="op">(</span><span class="va">z</span>, probs <span class="op">=</span> <span class="fl">0.75</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># S4 method for FillChromPeaksParam</span></span>
<span><span class="fu">expandMz</span><span class="op">(</span><span class="va">object</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># S4 method for FillChromPeaksParam</span></span>
<span><span class="fu">expandMz</span><span class="op">(</span><span class="va">object</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="va">value</span></span>
<span></span>
<span><span class="co"># S4 method for FillChromPeaksParam</span></span>
<span><span class="fu">expandRt</span><span class="op">(</span><span class="va">object</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># S4 method for FillChromPeaksParam</span></span>
<span><span class="fu">expandRt</span><span class="op">(</span><span class="va">object</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="va">value</span></span>
<span></span>
<span><span class="co"># S4 method for FillChromPeaksParam</span></span>
<span><span class="fu"><a href="findChromPeaks-centWave.html">ppm</a></span><span class="op">(</span><span class="va">object</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># S4 method for FillChromPeaksParam</span></span>
<span><span class="fu"><a href="findChromPeaks-centWave.html">ppm</a></span><span class="op">(</span><span class="va">object</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="va">value</span></span>
<span></span>
<span><span class="co"># S4 method for XCMSnExp,FillChromPeaksParam</span></span>
<span><span class="fu">fillChromPeaks</span><span class="op">(</span><span class="va">object</span>, <span class="va">param</span>, msLevel <span class="op">=</span> <span class="fl">1L</span>, BPPARAM <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/BiocParallel/man/register.html" class="external-link">bpparam</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># S4 method for XCMSnExp,ChromPeakAreaParam</span></span>
<span><span class="fu">fillChromPeaks</span><span class="op">(</span><span class="va">object</span>, <span class="va">param</span>, msLevel <span class="op">=</span> <span class="fl">1L</span>, BPPARAM <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/BiocParallel/man/register.html" class="external-link">bpparam</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># S4 method for XCMSnExp,missing</span></span>
<span><span class="fu">fillChromPeaks</span><span class="op">(</span><span class="va">object</span>, <span class="va">param</span>, BPPARAM <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/BiocParallel/man/register.html" class="external-link">bpparam</a></span><span class="op">(</span><span class="op">)</span>, msLevel <span class="op">=</span> <span class="fl">1L</span><span class="op">)</span></span></code></pre></div>
    </div>

    <div class="section level2">
    <h2 id="arguments">Arguments<a class="anchor" aria-label="anchor" href="#arguments"></a></h2>
    <dl><dt>object</dt>
<dd><p><code>XcmsExperiment</code> or <code>XCMSnExp</code> object with identified and
grouped chromatographic peaks.</p></dd>


<dt>param</dt>
<dd><p><code>ChromPeakAreaParam</code> or <code>FillChromPeaksParam</code> object
defining which approach should be used (see details section).</p></dd>


<dt>...</dt>
<dd><p>currently ignored.</p></dd>


<dt>msLevel</dt>
<dd><p><code>integer(1)</code> defining the MS level on which peak filling
should be performed (defaults to <code>msLevel = 1L</code>). Only peak filling
on one MS level at a time is supported, to fill in peaks for MS
level 1 and 2 run first using <code>msLevel = 1</code> and then (on the returned
result object) again with <code>msLevel = 2</code>.</p></dd>


<dt>chunkSize</dt>
<dd><p>For <code>fillChromPeaks</code> if <code>object</code> is an <code>XcmsExperiment</code>:
<code>integer(1)</code> defining the number of files (samples)
that should be loaded into memory and processed at the same time.
This setting thus allows to balance between memory
demand and speed (due to parallel processing). Because parallel
processing can only performed on the subset of data currently loaded
into memory in each iteration, the value for <code>chunkSize</code> should match
the defined  parallel setting setup. Using a parallel processing setup
using 4 CPUs (separate processes) but using <code>chunkSize = </code>1<code>will not perform any parallel processing, as only the data from one sample is loaded in memory at a time. On the other hand, setting</code>chunkSize` to
the total number of samples in an experiment will load the full MS data
into memory and will thus in most settings cause an out-of-memory error.</p></dd>


<dt>BPPARAM</dt>
<dd><p>Parallel processing settings.</p></dd>


<dt>expandMz</dt>
<dd><p>for <code>FillChromPeaksParam</code>: <code>numeric(1)</code> defining the
value by which the mz width of peaks should be expanded. Each peak is
expanded in mz direction by <code>expandMz *</code> their original m/z width.
A value of <code>0</code> means no expansion, a value of <code>1</code> grows each peak
by <code>1 *</code> the m/z width of the peak resulting in peaks with twice
their original size in m/z direction (expansion by half m/z width
to both sides).</p></dd>


<dt>expandRt</dt>
<dd><p>for <code>FillChromPeaksParam</code>: <code>numeric(1)</code>, same as
<code>expandMz</code> but for the retention time width.</p></dd>


<dt>ppm</dt>
<dd><p>for <code>FillChromPeaksParam</code>: <code>numeric(1)</code> optionally specifying
a <em>ppm</em> by which the m/z width of the peak region should be expanded.
For peaks with an m/z width smaller than
<code>mean(c(mzmin, mzmax)) * ppm / 1e6</code>, the <code>mzmin</code> will be replaced by
<code>mean(c(mzmin, mzmax)) - (mean(c(mzmin, mzmax)) * ppm / 2 / 1e6)</code>
<code>mzmax</code> by
<code>mean(c(mzmin, mzmax)) + (mean(c(mzmin, mzmax)) * ppm / 2 / 1e6)</code>.
This is applied before eventually expanding the m/z width using the
<code>expandMz</code> parameter.</p></dd>


<dt>fixedMz</dt>
<dd><p>for <code>FillChromPeaksParam</code>: <code>numeric(1)</code> defining a constant
factor by which the m/z width of each feature is to be expanded.
The m/z width is expanded on both sides by <code>fixedMz</code> (i.e. <code>fixedMz</code>
is subtracted from the lower m/z and added to the upper m/z). This
expansion is applied <em>after</em> <code>expandMz</code> and <code>ppm</code>.</p></dd>


<dt>fixedRt</dt>
<dd><p>for <code>FillChromPeaksParam</code>: <code>numeric(1)</code> defining a constant
factor by which the retention time width of each factor is to be
expanded. The rt width is expanded on both sides by <code>fixedRt</code> (i.e.
<code>fixedRt</code> is subtracted from the lower rt and added to the upper rt).
This expansion is applied <em>after</em> <code>expandRt</code>.</p></dd>


<dt>mzmin</dt>
<dd><p><code>function</code> to be applied to values in the <code>"mzmin"</code> column
of all chromatographic peaks of a feature to define the lower m/z
value of the area from which signal for the feature should be
integrated. Defaults to <code>mzmin = function(z) quantile(z, probs = 0.25)</code>
hence using the 25% quantile of all values.</p></dd>


<dt>mzmax</dt>
<dd><p><code>function</code> to be applied to values in the <code>"mzmax"</code> column
of all chromatographic peaks of a feature to define the upper m/z
value of the area from which signal for the feature should be
integrated. Defaults to  <code>mzmax = function(z) quantile(z, probs = 0.75)</code>
hence using the 75% quantile of all values.</p></dd>


<dt>rtmin</dt>
<dd><p><code>function</code> to be applied to values in the <code>"rtmin"</code> column
of all chromatographic peaks of a feature to define the lower rt
value of the area from which signal for the feature should be
integrated. Defaults to <code>rtmin = function(z) quantile(z, probs = 0.25)</code>
hence using the 25% quantile of all values.</p></dd>


<dt>rtmax</dt>
<dd><p><code>function</code> to be applied to values in the <code>"rtmax"</code> column
of all chromatographic peaks of a feature to define the upper rt
value of the area from which signal for the feature should be
integrated. Defaults to <code>rtmax = function(z) quantile(z, probs = 0.75)</code>
hence using the 75% quantile of all values.</p></dd>


<dt>value</dt>
<dd><p>The value for the slot.</p></dd>

</dl></div>
    <div class="section level2">
    <h2 id="value">Value<a class="anchor" aria-label="anchor" href="#value"></a></h2>
    

<p>An <a href="XcmsExperiment.html">XcmsExperiment</a> or  <code>XCMSnExp</code> object with previously missing
chromatographic peaks for features filled into its <code><a href="XCMSnExp-class.html">chromPeaks()</a></code> matrix.</p>


<p>The <code>FillChromPeaksParam</code> function returns a</p>
<p></p>
<p><code>FillChromPeaksParam</code> object.</p>
    </div>
    <div class="section level2">
    <h2 id="details">Details<a class="anchor" aria-label="anchor" href="#details"></a></h2>
    <p>After correspondence (i.e. grouping of chromatographic peaks across
samples) there will always be features (peak groups) that do not include
peaks from every sample. The <code>fillChromPeaks</code> method defines
intensity values for such features in the missing samples by integrating
the signal in the m/z-rt region of the feature. Two different approaches
to define this region are available: with <code>ChromPeakAreaParam</code> the region
is defined based on the detected <strong>chromatographic peaks</strong> of a feature,
while with <code>FillChromPeaksParam</code> the region is defined based on the m/z and
retention times of the <strong>feature</strong> (which represent the m/z and retentention
times of the apex position of the associated chromatographic peaks). For the
latter approach various parameters are available to increase the area from
which signal is to be integrated, either by a constant value (<code>fixedMz</code> and
<code>fixedRt</code>) or by a feature-relative amount (<code>expandMz</code> and <code>expandRt</code>).</p>
<p>Adjusted retention times will be used if available.</p>
<p>Based on the peak finding algorithm that was used to identify the
(chromatographic) peaks, different internal functions are used to
guarantee that the integrated peak signal matches as much as possible
the peak signal integration used during the peak detection. For peaks
identified with the <code><a href="findChromPeaks-matchedFilter.html">matchedFilter()</a></code> method, signal
integration is performed on the <em>profile matrix</em> generated with
the same settings used also during peak finding (using the same
<code>bin</code> size for example). For direct injection data and peaks
identified with the <code>MSW</code> algorithm signal is integrated
only along the mz dimension. For all other methods the complete (raw)
signal within the area is used.</p>
    </div>
    <div class="section level2">
    <h2 id="slots">Slots<a class="anchor" aria-label="anchor" href="#slots"></a></h2>
    

<dl><dt><code>expandMz,expandRt,ppm,fixedMz,fixedRt</code></dt>
<dd><p>See corresponding parameter
above.</p></dd>


<dt><code>rtmin,rtmax,mzmin,mzmax</code></dt>
<dd><p>See corresponding parameter above.</p></dd>


</dl></div>
    <div class="section level2">
    <h2 id="note">Note<a class="anchor" aria-label="anchor" href="#note"></a></h2>
    <p>The reported <code>"mzmin"</code>, <code>"mzmax"</code>, <code>"rtmin"</code> and
<code>"rtmax"</code> for the filled peaks represents the actual MS area from
which the signal was integrated.</p>
<p>No peak is filled in if no signal was present in a file/sample
in the respective mz-rt area. These samples will still show a <code>NA</code>
in the matrix returned by the <code><a href="XCMSnExp-peak-grouping-results.html">featureValues()</a></code> method.</p>
    </div>
    <div class="section level2">
    <h2 id="see-also">See also<a class="anchor" aria-label="anchor" href="#see-also"></a></h2>
    <div class="dont-index"><p><code><a href="groupChromPeaks.html">groupChromPeaks()</a></code> for methods to perform the correspondence.</p>
<p><a href="XcmsExperiment.html">featureArea</a> for the function to define the m/z-retention time
region for each feature.</p></div>
    </div>
    <div class="section level2">
    <h2 id="author">Author<a class="anchor" aria-label="anchor" href="#author"></a></h2>
    <p>Johannes Rainer</p>
    </div>

    <div class="section level2">
    <h2 id="ref-examples">Examples<a class="anchor" aria-label="anchor" href="#ref-examples"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">## Load a test data set with identified chromatographic peaks</span></span></span>
<span class="r-in"><span><span class="va">res</span> <span class="op">&lt;-</span> <span class="fu"><a href="loadXcmsData.html">loadXcmsData</a></span><span class="op">(</span><span class="st">"faahko_sub2"</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">## Disable parallel processing for this example</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/pkg/BiocParallel/man/register.html" class="external-link">register</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/BiocParallel/man/SerialParam-class.html" class="external-link">SerialParam</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">## Perform the correspondence. We assign all samples to the same group.</span></span></span>
<span class="r-in"><span><span class="va">res</span> <span class="op">&lt;-</span> <span class="fu"><a href="groupChromPeaks.html">groupChromPeaks</a></span><span class="op">(</span><span class="va">res</span>,</span></span>
<span class="r-in"><span>    param <span class="op">=</span> <span class="fu"><a href="groupChromPeaks.html">PeakDensityParam</a></span><span class="op">(</span>sampleGroups <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="fu"><a href="https://lgatto.github.io/MSnbase/reference/pSet-class.html" class="external-link">fileNames</a></span><span class="op">(</span><span class="va">res</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">## For how many features do we lack an integrated peak signal?</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html" class="external-link">is.na</a></span><span class="op">(</span><span class="fu"><a href="XCMSnExp-peak-grouping-results.html">featureValues</a></span><span class="op">(</span><span class="va">res</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] 26</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">## Filling missing peak data using the peak area from identified</span></span></span>
<span class="r-in"><span><span class="co">## chromatographic peaks.</span></span></span>
<span class="r-in"><span><span class="va">res</span> <span class="op">&lt;-</span> <span class="fu">fillChromPeaks</span><span class="op">(</span><span class="va">res</span>, param <span class="op">=</span> <span class="fu">ChromPeakAreaParam</span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">## How many missing values do we have after peak filling?</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html" class="external-link">is.na</a></span><span class="op">(</span><span class="fu"><a href="XCMSnExp-peak-grouping-results.html">featureValues</a></span><span class="op">(</span><span class="va">res</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] 3</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">## Get the peaks that have been filled in:</span></span></span>
<span class="r-in"><span><span class="va">fp</span> <span class="op">&lt;-</span> <span class="fu"><a href="XCMSnExp-class.html">chromPeaks</a></span><span class="op">(</span><span class="va">res</span><span class="op">)</span><span class="op">[</span><span class="fu"><a href="XCMSnExp-class.html">chromPeakData</a></span><span class="op">(</span><span class="va">res</span><span class="op">)</span><span class="op">$</span><span class="va">is_filled</span>, <span class="op">]</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">fp</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>          mz mzmin mzmax       rt    rtmin    rtmax      into intb   maxo sn</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> CP249 286.2 286.2 286.2 3252.556 3236.907 3274.857 1288521.3   NA  78048 NA</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> CP250 380.1 380.1 380.1 3172.743 3129.707 3173.526  677133.8   NA  27040 NA</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> CP251 447.2 447.2 447.2 3858.193 3828.068 3914.140 2156784.3   NA  61256 NA</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> CP252 497.2 497.2 497.2 3382.447 3379.317 3438.786 7672169.4   NA 310912 NA</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> CP253 510.2 510.2 510.2 3750.211 3741.213 3799.898 1927179.7   NA  61368 NA</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> CP254 531.2 531.2 531.2 3340.193 3328.848 3383.620 7589092.3   NA 254464 NA</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>       sample</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> CP249      1</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> CP250      1</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> CP251      1</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> CP252      1</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> CP253      1</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> CP254      1</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">## Get the process history step along with the parameters used to perform</span></span></span>
<span class="r-in"><span><span class="co">## The peak filling:</span></span></span>
<span class="r-in"><span><span class="va">ph</span> <span class="op">&lt;-</span> <span class="fu"><a href="XCMSnExp-class.html">processHistory</a></span><span class="op">(</span><span class="va">res</span>, type <span class="op">=</span> <span class="st">"Missing peak filling"</span><span class="op">)</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span></span></span>
<span class="r-in"><span><span class="va">ph</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Object of class "XProcessHistory"</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  type: Missing peak filling </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  date: Wed Dec  6 17:50:36 2023 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  info:  </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  fileIndex: 1,2,3 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  Parameter class: ChromPeakAreaParam </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  MS level(s) 1 </span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">## The parameter class:</span></span></span>
<span class="r-in"><span><span class="va">ph</span><span class="op">@</span><span class="va">param</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Object of class:  ChromPeakAreaParam </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  Parameters:</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  - rtmin: function (z) </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> quantile(z, probs = 0.25)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> &lt;environment: 0x56287b13c180&gt;</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  - rtmax: function (z) </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> quantile(z, probs = 0.75)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> &lt;environment: 0x56287b13c180&gt;</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  - mzmin: function (z) </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> quantile(z, probs = 0.25)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> &lt;environment: 0x56287b13c180&gt;</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  - mzmax: function (z) </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> quantile(z, probs = 0.75)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> &lt;environment: 0x56287b13c180&gt;</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">## It is also possible to remove filled-in peaks:</span></span></span>
<span class="r-in"><span><span class="va">res</span> <span class="op">&lt;-</span> <span class="fu"><a href="XCMSnExp-class.html">dropFilledChromPeaks</a></span><span class="op">(</span><span class="va">res</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html" class="external-link">is.na</a></span><span class="op">(</span><span class="fu"><a href="XCMSnExp-peak-grouping-results.html">featureValues</a></span><span class="op">(</span><span class="va">res</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] 26</span>
</code></pre></div>
    </div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p></p><p>Developed by Colin A. Smith, Ralf Tautenhahn, Steffen Neumann, Paul Benton, Christopher Conley, Johannes Rainer, William Kumler, Philippine Louail.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p><p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.9000.</p>
</div>

    </footer></div>

  

  

  </body></html>

