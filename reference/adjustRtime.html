<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><meta name="description" content='The adjustRtime method(s) perform retention time correction (alignment)
between chromatograms of different samples. Alignment is performed by defaul
on MS level 1 data. Retention times of spectra from other MS levels, if
present, are subsequently adjusted based on the adjusted retention times
of the MS1 spectra. Note that calling adjustRtime on a xcms result object
will remove any eventually present previous alignment results as well as
any correspondence analysis results.
The alignment method can be specified (and configured) using a dedicated
param argument.
Supported param objects are:
ObiwarpParam: performs retention time adjustment based on the full m/z -
rt data using the obiwarp method (Prince (2006)). It is based on the
original code but supports in addition
alignment of multiple samples by aligning each against a center sample.
The alignment is performed directly on the profile-matrix and can hence
be performed independently of the peak detection or peak grouping.
PeakGroupsParam: performs retention time correctoin based on the
alignment of features defined in all/most samples (corresponding to
house keeping compounds or marker compounds) (Smith 2006). First the
retention time deviation of these features is described by fitting either a
polynomial (smooth = "loess") or a linear (smooth = "linear") function
to the data points. These are then subsequently used to adjust the
retention time of each spectrum in each sample (even from spectra of
MS levels different than MS 1). Since the function is
based on features (i.e. chromatographic peaks grouped across samples) a
initial correspondence analysis has to be performed before using the
groupChromPeaks() function. Alternatively, it is also possible to
manually define a numeric matrix with retention times of markers in each
samples that should be used for alignment. Such a matrix can be passed
to the alignment function using the peakGroupsMatrix parameter of the
PeakGroupsParam parameter object. By default the adjustRtimePeakGroups
function is used to define this matrix. This function identifies peak
groups (features) for alignment in object based on the parameters defined
in param. See also do_adjustRtime_peakGroups() for the core API
function.

'><title>Alignment: Retention time correction methods. — adjustRtime • xcms</title><!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png"><link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png"><link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png"><link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png"><link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png"><link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png"><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous"><!-- bootstrap-toc --><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@v1.0.1/dist/bootstrap-toc.min.js" integrity="sha256-4veVQbu7//Lk5TSmc7YV48MxtMy98e26cf5MrgZYnwo=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Alignment: Retention time correction methods. — adjustRtime"><meta property="og:description" content='The adjustRtime method(s) perform retention time correction (alignment)
between chromatograms of different samples. Alignment is performed by defaul
on MS level 1 data. Retention times of spectra from other MS levels, if
present, are subsequently adjusted based on the adjusted retention times
of the MS1 spectra. Note that calling adjustRtime on a xcms result object
will remove any eventually present previous alignment results as well as
any correspondence analysis results.
The alignment method can be specified (and configured) using a dedicated
param argument.
Supported param objects are:
ObiwarpParam: performs retention time adjustment based on the full m/z -
rt data using the obiwarp method (Prince (2006)). It is based on the
original code but supports in addition
alignment of multiple samples by aligning each against a center sample.
The alignment is performed directly on the profile-matrix and can hence
be performed independently of the peak detection or peak grouping.
PeakGroupsParam: performs retention time correctoin based on the
alignment of features defined in all/most samples (corresponding to
house keeping compounds or marker compounds) (Smith 2006). First the
retention time deviation of these features is described by fitting either a
polynomial (smooth = "loess") or a linear (smooth = "linear") function
to the data points. These are then subsequently used to adjust the
retention time of each spectrum in each sample (even from spectra of
MS levels different than MS 1). Since the function is
based on features (i.e. chromatographic peaks grouped across samples) a
initial correspondence analysis has to be performed before using the
groupChromPeaks() function. Alternatively, it is also possible to
manually define a numeric matrix with retention times of markers in each
samples that should be used for alignment. Such a matrix can be passed
to the alignment function using the peakGroupsMatrix parameter of the
PeakGroupsParam parameter object. By default the adjustRtimePeakGroups
function is used to define this matrix. This function identifies peak
groups (features) for alignment in object based on the parameters defined
in param. See also do_adjustRtime_peakGroups() for the core API
function.

'><meta property="og:image" content="https://sneumann.github.io/xcms/logo.png"><!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-dark navbar-expand-lg bg-primary"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">xcms</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">4.1.2</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="nav-item">
  <a class="nav-link" href="../articles/xcms.html">Get started</a>
</li>
<li class="active nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
<li class="nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-articles">Articles</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-articles">
    <a class="dropdown-item" href="../articles/LC-MS-feature-grouping.html">Compounding (grouping) of LC-MS features</a>
    <a class="dropdown-item" href="../articles/xcms-direct-injection.html">Grouping FTICR-MS data with xcms</a>
    <a class="dropdown-item" href="../articles/xcms-lcms-ms.html">LC-MS/MS data analysis with xcms</a>
  </div>
</li>
      </ul><form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off"></form>

      <ul class="navbar-nav"><li class="nav-item">
  <a class="external-link nav-link" href="https://github.com/sneumann/xcms/" aria-label="github">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul></div>

    
  </div>
</nav><div class="container template-reference-topic">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>Alignment: Retention time correction methods.</h1>
      <small class="dont-index">Source: <a href="https://github.com/sneumann/xcms/blob/HEAD/R/AllGenerics.R" class="external-link"><code>R/AllGenerics.R</code></a>, <a href="https://github.com/sneumann/xcms/blob/HEAD/R/XcmsExperiment.R" class="external-link"><code>R/XcmsExperiment.R</code></a>, <a href="https://github.com/sneumann/xcms/blob/HEAD/R/functions-Params.R" class="external-link"><code>R/functions-Params.R</code></a>, and 4 more</small>
      <div class="d-none name"><code>adjustRtime.Rd</code></div>
    </div>

    <div class="ref-description section level2">
    <p>The <code>adjustRtime</code> method(s) perform retention time correction (alignment)
between chromatograms of different samples. Alignment is performed by defaul
on MS level 1 data. Retention times of spectra from other MS levels, if
present, are subsequently adjusted based on the adjusted retention times
of the MS1 spectra. Note that calling <code>adjustRtime</code> on a <em>xcms</em> result object
will remove any eventually present previous alignment results as well as
any correspondence analysis results.</p>
<p>The alignment method can be specified (and configured) using a dedicated
<code>param</code> argument.</p>
<p>Supported <code>param</code> objects are:</p><ul><li><p><code>ObiwarpParam</code>: performs retention time adjustment based on the full m/z -
rt data using the <em>obiwarp</em> method (Prince (2006)). It is based on the
<a href="http://obi-warp.sourceforge.net" class="external-link">original code</a> but supports in addition
alignment of multiple samples by aligning each against a <em>center</em> sample.
The alignment is performed directly on the <a href="profMat-xcmsSet.html">profile-matrix</a> and can hence
be performed independently of the peak detection or peak grouping.</p></li>
<li><p><code>PeakGroupsParam</code>: performs retention time correctoin based on the
alignment of features defined in all/most samples (corresponding to
<em>house keeping compounds</em> or marker compounds) (Smith 2006). First the
retention time deviation of these features is described by fitting either a
polynomial (<code>smooth = "loess"</code>) or a linear (<code>smooth = "linear"</code>) function
to the data points. These are then subsequently used to adjust the
retention time of each spectrum in each sample (even from spectra of
MS levels different than MS 1). Since the function is
based on features (i.e. chromatographic peaks grouped across samples) a
initial correspondence analysis has to be performed <strong>before</strong> using the
<code><a href="groupChromPeaks.html">groupChromPeaks()</a></code> function. Alternatively, it is also possible to
manually define a <code>numeric</code> matrix with retention times of markers in each
samples that should be used for alignment. Such a <code>matrix</code> can be passed
to the alignment function using the <code>peakGroupsMatrix</code> parameter of the
<code>PeakGroupsParam</code> parameter object. By default the <code>adjustRtimePeakGroups</code>
function is used to define this <code>matrix</code>. This function identifies peak
groups (features) for alignment in <code>object</code> based on the parameters defined
in <code>param</code>. See also <code><a href="do_adjustRtime_peakGroups.html">do_adjustRtime_peakGroups()</a></code> for the core API
function.</p></li>
</ul></div>

    <div class="section level2">
    <h2 id="ref-usage">Usage<a class="anchor" aria-label="anchor" href="#ref-usage"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">adjustRtime</span><span class="op">(</span><span class="va">object</span>, <span class="va">param</span>, <span class="va">...</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># S4 method for MsExperiment,ObiwarpParam</span></span>
<span><span class="fu">adjustRtime</span><span class="op">(</span><span class="va">object</span>, <span class="va">param</span>, chunkSize <span class="op">=</span> <span class="fl">2L</span>, BPPARAM <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/BiocParallel/man/register.html" class="external-link">bpparam</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># S4 method for MsExperiment,PeakGroupsParam</span></span>
<span><span class="fu">adjustRtime</span><span class="op">(</span><span class="va">object</span>, <span class="va">param</span>, msLevel <span class="op">=</span> <span class="fl">1L</span>, <span class="va">...</span><span class="op">)</span></span>
<span></span>
<span><span class="fu">PeakGroupsParam</span><span class="op">(</span></span>
<span>  minFraction <span class="op">=</span> <span class="fl">0.9</span>,</span>
<span>  extraPeaks <span class="op">=</span> <span class="fl">1</span>,</span>
<span>  smooth <span class="op">=</span> <span class="st">"loess"</span>,</span>
<span>  span <span class="op">=</span> <span class="fl">0.2</span>,</span>
<span>  family <span class="op">=</span> <span class="st">"gaussian"</span>,</span>
<span>  peakGroupsMatrix <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span>nrow <span class="op">=</span> <span class="fl">0</span>, ncol <span class="op">=</span> <span class="fl">0</span><span class="op">)</span>,</span>
<span>  subset <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/integer.html" class="external-link">integer</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>  subsetAdjust <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"average"</span>, <span class="st">"previous"</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="fu">ObiwarpParam</span><span class="op">(</span></span>
<span>  binSize <span class="op">=</span> <span class="fl">1</span>,</span>
<span>  centerSample <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/integer.html" class="external-link">integer</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>  response <span class="op">=</span> <span class="fl">1L</span>,</span>
<span>  distFun <span class="op">=</span> <span class="st">"cor_opt"</span>,</span>
<span>  gapInit <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">numeric</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>  gapExtend <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">numeric</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>  factorDiag <span class="op">=</span> <span class="fl">2</span>,</span>
<span>  factorGap <span class="op">=</span> <span class="fl">1</span>,</span>
<span>  localAlignment <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  initPenalty <span class="op">=</span> <span class="fl">0</span>,</span>
<span>  subset <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/integer.html" class="external-link">integer</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>  subsetAdjust <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"average"</span>, <span class="st">"previous"</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="fu">adjustRtimePeakGroups</span><span class="op">(</span><span class="va">object</span>, param <span class="op">=</span> <span class="fu">PeakGroupsParam</span><span class="op">(</span><span class="op">)</span>, msLevel <span class="op">=</span> <span class="fl">1L</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># S4 method for OnDiskMSnExp,ObiwarpParam</span></span>
<span><span class="fu">adjustRtime</span><span class="op">(</span><span class="va">object</span>, <span class="va">param</span>, msLevel <span class="op">=</span> <span class="fl">1L</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># S4 method for PeakGroupsParam</span></span>
<span><span class="fu"><a href="groupChromPeaks.html">minFraction</a></span><span class="op">(</span><span class="va">object</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># S4 method for PeakGroupsParam</span></span>
<span><span class="fu"><a href="groupChromPeaks.html">minFraction</a></span><span class="op">(</span><span class="va">object</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="va">value</span></span>
<span></span>
<span><span class="co"># S4 method for PeakGroupsParam</span></span>
<span><span class="fu">extraPeaks</span><span class="op">(</span><span class="va">object</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># S4 method for PeakGroupsParam</span></span>
<span><span class="fu">extraPeaks</span><span class="op">(</span><span class="va">object</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="va">value</span></span>
<span></span>
<span><span class="co"># S4 method for PeakGroupsParam</span></span>
<span><span class="fu">smooth</span><span class="op">(</span><span class="va">x</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># S4 method for PeakGroupsParam</span></span>
<span><span class="fu">smooth</span><span class="op">(</span><span class="va">object</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="va">value</span></span>
<span></span>
<span><span class="co"># S4 method for PeakGroupsParam</span></span>
<span><span class="fu">span</span><span class="op">(</span><span class="va">object</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># S4 method for PeakGroupsParam</span></span>
<span><span class="fu">span</span><span class="op">(</span><span class="va">object</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="va">value</span></span>
<span></span>
<span><span class="co"># S4 method for PeakGroupsParam</span></span>
<span><span class="fu">family</span><span class="op">(</span><span class="va">object</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># S4 method for PeakGroupsParam</span></span>
<span><span class="fu">family</span><span class="op">(</span><span class="va">object</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="va">value</span></span>
<span></span>
<span><span class="co"># S4 method for PeakGroupsParam</span></span>
<span><span class="fu">peakGroupsMatrix</span><span class="op">(</span><span class="va">object</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># S4 method for PeakGroupsParam</span></span>
<span><span class="fu">peakGroupsMatrix</span><span class="op">(</span><span class="va">object</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="va">value</span></span>
<span></span>
<span><span class="co"># S4 method for PeakGroupsParam</span></span>
<span><span class="fu">subset</span><span class="op">(</span><span class="va">x</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># S4 method for PeakGroupsParam</span></span>
<span><span class="fu">subset</span><span class="op">(</span><span class="va">object</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="va">value</span></span>
<span></span>
<span><span class="co"># S4 method for PeakGroupsParam</span></span>
<span><span class="fu">subsetAdjust</span><span class="op">(</span><span class="va">object</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># S4 method for PeakGroupsParam</span></span>
<span><span class="fu">subsetAdjust</span><span class="op">(</span><span class="va">object</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="va">value</span></span>
<span></span>
<span><span class="co"># S4 method for ObiwarpParam</span></span>
<span><span class="fu"><a href="findChromPeaks-matchedFilter.html">binSize</a></span><span class="op">(</span><span class="va">object</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># S4 method for ObiwarpParam</span></span>
<span><span class="fu"><a href="findChromPeaks-matchedFilter.html">binSize</a></span><span class="op">(</span><span class="va">object</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="va">value</span></span>
<span></span>
<span><span class="co"># S4 method for ObiwarpParam</span></span>
<span><span class="fu">centerSample</span><span class="op">(</span><span class="va">object</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># S4 method for ObiwarpParam</span></span>
<span><span class="fu">centerSample</span><span class="op">(</span><span class="va">object</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="va">value</span></span>
<span></span>
<span><span class="co"># S4 method for ObiwarpParam</span></span>
<span><span class="fu">response</span><span class="op">(</span><span class="va">object</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># S4 method for ObiwarpParam</span></span>
<span><span class="fu">response</span><span class="op">(</span><span class="va">object</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="va">value</span></span>
<span></span>
<span><span class="co"># S4 method for ObiwarpParam</span></span>
<span><span class="fu">distFun</span><span class="op">(</span><span class="va">object</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># S4 method for ObiwarpParam</span></span>
<span><span class="fu">distFun</span><span class="op">(</span><span class="va">object</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="va">value</span></span>
<span></span>
<span><span class="co"># S4 method for ObiwarpParam</span></span>
<span><span class="fu">gapInit</span><span class="op">(</span><span class="va">object</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># S4 method for ObiwarpParam</span></span>
<span><span class="fu">gapInit</span><span class="op">(</span><span class="va">object</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="va">value</span></span>
<span></span>
<span><span class="co"># S4 method for ObiwarpParam</span></span>
<span><span class="fu">gapExtend</span><span class="op">(</span><span class="va">object</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># S4 method for ObiwarpParam</span></span>
<span><span class="fu">gapExtend</span><span class="op">(</span><span class="va">object</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="va">value</span></span>
<span></span>
<span><span class="co"># S4 method for ObiwarpParam</span></span>
<span><span class="fu">factorDiag</span><span class="op">(</span><span class="va">object</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># S4 method for ObiwarpParam</span></span>
<span><span class="fu">factorDiag</span><span class="op">(</span><span class="va">object</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="va">value</span></span>
<span></span>
<span><span class="co"># S4 method for ObiwarpParam</span></span>
<span><span class="fu">factorGap</span><span class="op">(</span><span class="va">object</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># S4 method for ObiwarpParam</span></span>
<span><span class="fu">factorGap</span><span class="op">(</span><span class="va">object</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="va">value</span></span>
<span></span>
<span><span class="co"># S4 method for ObiwarpParam</span></span>
<span><span class="fu">localAlignment</span><span class="op">(</span><span class="va">object</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># S4 method for ObiwarpParam</span></span>
<span><span class="fu">localAlignment</span><span class="op">(</span><span class="va">object</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="va">value</span></span>
<span></span>
<span><span class="co"># S4 method for ObiwarpParam</span></span>
<span><span class="fu">initPenalty</span><span class="op">(</span><span class="va">object</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># S4 method for ObiwarpParam</span></span>
<span><span class="fu">initPenalty</span><span class="op">(</span><span class="va">object</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="va">value</span></span>
<span></span>
<span><span class="co"># S4 method for ObiwarpParam</span></span>
<span><span class="fu">subset</span><span class="op">(</span><span class="va">x</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># S4 method for ObiwarpParam</span></span>
<span><span class="fu">subset</span><span class="op">(</span><span class="va">object</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="va">value</span></span>
<span></span>
<span><span class="co"># S4 method for ObiwarpParam</span></span>
<span><span class="fu">subsetAdjust</span><span class="op">(</span><span class="va">object</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># S4 method for ObiwarpParam</span></span>
<span><span class="fu">subsetAdjust</span><span class="op">(</span><span class="va">object</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="va">value</span></span>
<span></span>
<span><span class="co"># S4 method for XCMSnExp,PeakGroupsParam</span></span>
<span><span class="fu">adjustRtime</span><span class="op">(</span><span class="va">object</span>, <span class="va">param</span>, msLevel <span class="op">=</span> <span class="fl">1L</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># S4 method for XCMSnExp,ObiwarpParam</span></span>
<span><span class="fu">adjustRtime</span><span class="op">(</span><span class="va">object</span>, <span class="va">param</span>, msLevel <span class="op">=</span> <span class="fl">1L</span><span class="op">)</span></span></code></pre></div>
    </div>

    <div class="section level2">
    <h2 id="arguments">Arguments<a class="anchor" aria-label="anchor" href="#arguments"></a></h2>
    <dl><dt>object</dt>
<dd><p>For <code>adjustRtime</code>: an <code><a href="https://lgatto.github.io/MSnbase/reference/OnDiskMSnExp-class.html" class="external-link">OnDiskMSnExp()</a></code>, <code><a href="XCMSnExp-class.html">XCMSnExp()</a></code>,
<code><a href="https://rdrr.io/pkg/MsExperiment/man/MsExperiment.html" class="external-link">MsExperiment()</a></code> or <code><a href="XcmsExperiment.html">XcmsExperiment()</a></code> object.</p></dd>


<dt>param</dt>
<dd><p>The parameter object defining the alignment method (and its
setting).</p></dd>


<dt>...</dt>
<dd><p>ignored.</p></dd>


<dt>chunkSize</dt>
<dd><p>For <code>adjustRtime</code> if <code>object</code> is either an <code>MsExperiment</code> or
<code>XcmsExperiment</code>: <code>integer(1)</code> defining the number of files (samples)
that should be loaded into memory and processed at the same time.
Alignment is then performed in parallel (per sample) on this subset of
loaded data. This setting thus allows to balance between memory
demand and speed (due to parallel processing). Because parallel
processing can only performed on the subset of data currently loaded
into memory in each iteration, the value for <code>chunkSize</code> should match
the defined  parallel setting setup. Using a parallel processing setup
using 4 CPUs (separate processes) but using <code>chunkSize = </code>1<code>will not perform any parallel processing, as only the data from one sample is loaded in memory at a time. On the other hand, setting</code>chunkSize` to
the total number of samples in an experiment will load the full MS data
into memory and will thus in most settings cause an out-of-memory error.</p></dd>


<dt>BPPARAM</dt>
<dd><p>parallel processing setup. Defaults to <code>BPPARAM = bpparam()</code>.
See <code><a href="https://rdrr.io/pkg/BiocParallel/man/register.html" class="external-link">bpparam()</a></code> for details.</p></dd>


<dt>msLevel</dt>
<dd><p>For <code>adjustRtime</code>: <code>integer(1)</code> defining the MS level on
which the alignment should be performed.</p></dd>


<dt>minFraction</dt>
<dd><p>For <code>PeakGroupsParam</code>: <code>numeric(1)</code> between 0 and 1
defining the minimum required fraction of samples in which peaks for
the peak group were identified. Peak groups passing this criteria will
be aligned across samples and retention times of individual spectra will
be adjusted based on this alignment. For <code>minFraction = 1</code> the peak
group has to contain peaks in all samples of the experiment. Note that if
<code>subset</code> is provided, the specified fraction is relative to the
defined subset of samples and not to the total number of samples within
the experiment (i.e. a peak has to be present in the specified
proportion of subset samples).</p></dd>


<dt>extraPeaks</dt>
<dd><p>For <code>PeakGroupsParam</code>: <code>numeric(1)</code> defining the maximal
number of additional peaks for all samples to be assigned to a peak
group (feature) for retention time correction. For a data set with 6
samples, <code>extraPeaks = 1</code> uses all peak groups with a total peak count
<code>&lt;= 6 + 1</code>. The total peak count is the total number of peaks being
assigned to a peak group and considers also multiple peaks within a
sample that are assigned to the group.</p></dd>


<dt>smooth</dt>
<dd><p>For <code>PeakGroupsParam</code>: <code>character(1)</code> defining the function to
be used to interpolate corrected retention times for all peak groups.
Can be either <code>"loess"</code> or <code>"linear"</code>.</p></dd>


<dt>span</dt>
<dd><p>For <code>PeakGroupsParam</code>: <code>numeric(1)</code> defining the degree of
smoothing (if <code>smooth = "loess"</code>). This parameter is passed to the
internal call to <code><a href="https://rdrr.io/r/stats/loess.html" class="external-link">loess()</a></code>.</p></dd>


<dt>family</dt>
<dd><p>For <code>PeakGroupsParam</code>: <code>character(1)</code> defining the method for
loess smoothing. Allowed values are <code>"gaussian"</code> and <code>"symmetric"</code>. See
<code><a href="https://rdrr.io/r/stats/loess.html" class="external-link">loess()</a></code> for more information.</p></dd>


<dt>peakGroupsMatrix</dt>
<dd><p>For <code>PeakGroupsParam</code>: optional <code>matrix</code> of (raw)
retention times for the (marker) peak groups on which the alignment
should be performed. Each column represents a sample, each row a
feature/peak group. The <code>adjustRtimePeakGroups</code> method is used by
default to determine this matrix on the provided <code>object</code>.</p></dd>


<dt>subset</dt>
<dd><p>For <code>ObiwarpParam</code> and <code>PeakGroupsParam</code>: <code>integer</code> with the
indices of samples within the experiment on which the alignment models
should be estimated.
Samples not part of the subset are adjusted based on the closest subset
sample. See <em>Subset-based alignment</em> section for details.</p></dd>


<dt>subsetAdjust</dt>
<dd><p>For <code>ObiwarpParam</code> and <code>PeakGroupsParam</code>: <code>character(1)</code>
specifying the method with which non-subset samples should be adjusted.
Supported options are <code>"previous"</code> and <code>"average"</code> (default).
See <em>Subset-based alignment</em> section for details.</p></dd>


<dt>binSize</dt>
<dd><p><code>numeric(1)</code> defining the bin size (in mz dimension)
to be used for the <em>profile matrix</em> generation. See <code>step</code>
parameter in <code><a href="profMat-xcmsSet.html">profile-matrix</a></code> documentation for more details.</p></dd>


<dt>centerSample</dt>
<dd><p><code>integer(1)</code> defining the index of the center sample
in the experiment. It defaults to
<code>floor(median(1:length(fileNames(object))))</code>. Note that if
<code>subset</code> is used, the index passed with <code>centerSample</code> is
within these subset samples.</p></dd>


<dt>response</dt>
<dd><p>For <code>ObiwarpParam</code>: <code>numeric(1)</code> defining the
<em>responsiveness</em> of warping with <code>response = 0</code> giving linear warping on
start and end points and <code>response = 100</code> warping using all bijective
anchors.</p></dd>


<dt>distFun</dt>
<dd><p>For <code>ObiwarpParam</code>: <code>character(1)</code> defining the distance
function to be used. Allowed values are <code>"cor"</code> (Pearson's correlation),
<code>"cor_opt"</code> (calculate only 10% diagonal band of distance matrix;
better runtime), <code>"cov"</code> (covariance), <code>"prd"</code> (product) and <code>"euc"</code>
(Euclidian distance). The default value is <code>distFun = "cor_opt"</code>.</p></dd>


<dt>gapInit</dt>
<dd><p>For <code>ObiwarpParam</code>: <code>numeric(1)</code> defining the penalty for gap
opening. The default value for depends on the value of <code>distFun</code>:
<code>distFun = "cor"</code> and <code>distFun = "cor_opt"</code> it is <code>0.3</code>, for
<code>distFun = "cov"</code> and <code>distFun = "prd"</code> <code>0.0</code> and for <code>distFun = "euc"</code>
<code>0.9</code>.</p></dd>


<dt>gapExtend</dt>
<dd><p>For <code>ObiwarpParam</code>: <code>numeric(1)</code> defining the penalty for
gap enlargement. The default value for <code>gapExtend</code> depends on the value
of <code>distFun</code>: for <code>distFun = "cor"</code> and <code>distFun = "cor_opt"</code> it is
<code>2.4</code>, <code>distFun = "cov"</code> <code>11.7</code>, for <code>distFun = "euc"</code> <code>1.8</code> and for
<code>distFun = "prd"</code> <code>7.8</code>.</p></dd>


<dt>factorDiag</dt>
<dd><p>For <code>ObiwarpParam</code>: <code>numeric(1)</code> defining the local weight
applied to diagonal moves in the alignment.</p></dd>


<dt>factorGap</dt>
<dd><p>For <code>ObiwarpParam</code>: <code>numeric(1)</code> defining the local weight
for gap moves in the alignment.</p></dd>


<dt>localAlignment</dt>
<dd><p>For <code>ObiwarpParam</code>: <code>logical(1)</code> whether a local
alignment should be performed instead of the default global alignment.</p></dd>


<dt>initPenalty</dt>
<dd><p>For <code>ObiwarpParam</code>: <code>numeric(1)</code> defining the penalty for
initiating an alignment (for local alignment only).</p></dd>


<dt>value</dt>
<dd><p>The value for the slot.</p></dd>


<dt>x</dt>
<dd><p>An <code>ObiwarpParam</code> or <code>PeakGroupsParam</code> object.</p></dd>

</dl></div>
    <div class="section level2">
    <h2 id="value">Value<a class="anchor" aria-label="anchor" href="#value"></a></h2>
    

<p><code>adjustRtime</code> on an <code>OnDiskMSnExp</code> or <code>XCMSnExp</code> object will return an
<code>XCMSnExp</code> object with the alignment results.</p>


<p><code>adjustRtime</code> on an <code>MsExperiment</code> or <code>XcmsExperiment</code> will return an
<code>XcmsExperiment</code> with the adjusted retention times stored in an new
<em>spectra variable</em></p>
<p></p>
<p><code>rtime_adjusted</code> in the object's <code>spectra</code>.</p>


<p><code>ObiwarpParam</code> and <code>PeakGroupsParam</code> return the respective parameter object.</p>


<p><code>adjustRtimeGroups</code> returns a <code>matrix</code> with the retention times of <em>marker</em></p>


<p>features in each sample (each row one feature, each row one sample).</p>
    </div>
    <div class="section level2">
    <h2 id="subset-based-alignment">Subset-based alignment<a class="anchor" aria-label="anchor" href="#subset-based-alignment"></a></h2>
    


<p>All alignment methods allow to perform the retention time correction on a
user-selected subset of samples (e.g. QC samples) after which all samples
not part of that subset will be adjusted based on the adjusted retention
times of the <em>closest</em> subset sample (close in terms of index within <code>object</code>
and hence possibly injection index). It is thus suggested to load MS data
files in the order in which their samples were injected in the measurement
run(s).</p>
<p>How the non-subset samples are adjusted depends also on the parameter
<code>subsetAdjust</code>: with <code>subsetAdjust = "previous"</code>, each non-subset
sample is adjusted based on the closest <em>previous</em> subset sample which
results in most cases with adjusted retention times of the non-subset
sample being identical to the subset sample on which the adjustment bases.
The second, default, option is <code>subsetAdjust = "average"</code> in which case
each non subset sample is adjusted based on the average retention time
adjustment from the previous and following subset sample. For the average,
a weighted mean is used with weights being the inverse of the distance of
the non-subset sample to the subset samples used for alignment.</p>
<p>See also section <em>Alignment of experiments including blanks</em> in the
<em>xcms</em> vignette for more details.</p>
    </div>
    <div class="section level2">
    <h2 id="references">References<a class="anchor" aria-label="anchor" href="#references"></a></h2>
    <p>Prince, J. T., and Marcotte, E. M. (2006) "Chromatographic Alignment of
ESI-LC-MS Proteomic Data Sets by Ordered Bijective Interpolated Warping"
<em>Anal. Chem.</em>, 78 (17), 6140-6152.</p>
<p>Smith, C.A., Want, E.J., O'Maille, G., Abagyan, R. and Siuzdak, G. (2006).
"XCMS: Processing Mass Spectrometry Data for Metabolite Profiling Using
Nonlinear Peak Alignment, Matching, and Identification" <em>Anal. Chem.</em>
78:779-787.</p>
    </div>
    <div class="section level2">
    <h2 id="see-also">See also<a class="anchor" aria-label="anchor" href="#see-also"></a></h2>
    <div class="dont-index"><p><code><a href="plotAdjustedRtime.html">plotAdjustedRtime()</a></code> for visualization of alignment results.</p></div>
    </div>
    <div class="section level2">
    <h2 id="author">Author<a class="anchor" aria-label="anchor" href="#author"></a></h2>
    <p>Colin Smith, Johannes Rainer</p>
    </div>

  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p></p><p>Developed by Colin A. Smith, Ralf Tautenhahn, Steffen Neumann, Paul Benton, Christopher Conley, Johannes Rainer, Philippine Louail.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p><p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.9000.</p>
</div>

    </footer></div>

  

  

  </body></html>

