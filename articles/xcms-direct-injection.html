<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Grouping FTICR-MS data with xcms • xcms</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Grouping FTICR-MS data with xcms">
<meta property="og:description" content="xcms">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">xcms</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">3.11.1</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fas fa fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../articles/xcms.html">Get started</a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/new_functionality.html">New and modified functionality in xcms</a>
    </li>
    <li>
      <a href="../articles/xcms-direct-injection.html">Grouping FTICR-MS data with xcms</a>
    </li>
    <li>
      <a href="../articles/xcms-lcms-ms.html">LC-MS/MS data analysis with xcms</a>
    </li>
  </ul>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/sneumann/xcms/">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Grouping FTICR-MS data with xcms</h1>
                        <h4 class="author">Joachim Bargsten</h4>
                                    <h4 class="author">Johannes Rainer</h4>
                        
      
      <small class="dont-index">Source: <a href="https://github.com/sneumann/xcms/blob/master/vignettes/xcms-direct-injection.Rmd"><code>vignettes/xcms-direct-injection.Rmd</code></a></small>
      <div class="hidden name"><code>xcms-direct-injection.Rmd</code></div>

    </div>

    
    
<script type="text/javascript">
document.addEventListener("DOMContentLoaded", function() {
  document.querySelector("h1").className = "title";
});
</script><script type="text/javascript">
document.addEventListener("DOMContentLoaded", function() {
  var links = document.links;  
  for (var i = 0, linksLength = links.length; i < linksLength; i++)
    if (links[i].hostname != window.location.hostname)
      links[i].target = '_blank';
});
</script><div id="introduction" class="section level1">
<h1 class="hasAnchor">
<a href="#introduction" class="anchor"></a>Introduction</h1>
<p>This document describes how to use <em><a href="https://bioconductor.org/packages/3.11/xcms">xcms</a></em> for the analysis of direct injection mass spec data, including peak detection, calibration and correspondence (grouping of peaks across samples).</p>
</div>
<div id="peak-detection" class="section level1">
<h1 class="hasAnchor">
<a href="#peak-detection" class="anchor"></a>Peak detection</h1>
<p>Prior to any other analysis step, peaks have to be identified in the mass spec data. In contrast to the typical metabolomics workflow, in which peaks are identified in the chromatographic (time) dimension, in direct injection mass spec data sets peaks are identified in the m/z dimension. <em><a href="https://bioconductor.org/packages/3.11/xcms">xcms</a></em> uses functionality from the <code>MassSpecWavelet</code> package to identify such peaks.</p>
<p>Below we load the required packages. For information on the parallel processing setup please see the <code>BiocParallel</code> vignette.</p>
<div class="sourceCode" id="cb1"><html><body><pre class="r"><span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="no">xcms</span>)
<span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="no">MassSpecWavelet</span>)

<span class="fu">register</span>(<span class="fu">SerialParam</span>())</pre></body></html></div>
<p>In this documentation we use an example data set from the <em><a href="https://bioconductor.org/packages/3.11/msdata">msdata</a></em> package. Assuming that <em><a href="https://bioconductor.org/packages/3.11/msdata">msdata</a></em> is installed, we locate the path of the package and load the data set. We create also a <code>data.frame</code> describing the experimental setup based on the file names.</p>
<div class="sourceCode" id="cb2"><html><body><pre class="r"><span class="no">mzdata_path</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/system.file.html">system.file</a></span>(<span class="st">"fticr"</span>, <span class="kw">package</span> <span class="kw">=</span> <span class="st">"msdata"</span>)
<span class="no">mzdata_files</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.files.html">list.files</a></span>(<span class="no">mzdata_path</span>, <span class="kw">recursive</span> <span class="kw">=</span> <span class="fl">TRUE</span>, <span class="kw">full.names</span> <span class="kw">=</span> <span class="fl">TRUE</span>)

<span class="co">## Create a data.frame assigning samples to sample groups, i.e. ham4 and ham5.</span>
<span class="no">grp</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span>(<span class="st">"ham4"</span>, <span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span>(<span class="no">mzdata_files</span>))
<span class="no">grp</span>[<span class="fu"><a href="https://rdrr.io/r/base/grep.html">grep</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/basename.html">basename</a></span>(<span class="no">mzdata_files</span>), <span class="kw">pattern</span> <span class="kw">=</span> <span class="st">"^HAM005"</span>)] <span class="kw">&lt;-</span> <span class="st">"ham5"</span>
<span class="no">pd</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span>(<span class="kw">filename</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/basename.html">basename</a></span>(<span class="no">mzdata_files</span>), <span class="kw">sample_group</span> <span class="kw">=</span> <span class="no">grp</span>)

<span class="co">## Load the data.</span>
<span class="no">ham_raw</span> <span class="kw">&lt;-</span> <span class="fu">readMSData</span>(<span class="kw">files</span> <span class="kw">=</span> <span class="no">mzdata_files</span>,
                      <span class="kw">pdata</span> <span class="kw">=</span> <span class="fu">new</span>(<span class="st">"NAnnotatedDataFrame"</span>, <span class="no">pd</span>),
                      <span class="kw">mode</span> <span class="kw">=</span> <span class="st">"onDisk"</span>)</pre></body></html></div>
<p>The data files are from <em>direct injection</em> mass spectrometry experiments, i.e. we have only a single spectrum available for each sample and no retention times.</p>
<div class="sourceCode" id="cb3"><html><body><pre class="r"><span class="co">## Only a single spectrum with an *artificial* retention time is available</span>
<span class="co">## for each sample</span>
<span class="fu">rtime</span>(<span class="no">ham_raw</span>)</pre></body></html></div>
<pre><code>## F01.S1 F02.S1 F03.S1 F04.S1 F05.S1 F06.S1 F07.S1 F08.S1 F09.S1 F10.S1 
##      1      1      1      1      1      1      1      1      1      1</code></pre>
<p>Peaks are identified within each spectrum using the <em>mass spec wavelet</em> method.</p>
<div class="sourceCode" id="cb5"><html><body><pre class="r"><span class="co">## Define the parameters for the peak detection</span>
<span class="no">msw</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/findPeaks-MSW.html">MSWParam</a></span>(<span class="kw">scales</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fl">1</span>, <span class="fl">4</span>, <span class="fl">9</span>), <span class="kw">nearbyPeak</span> <span class="kw">=</span> <span class="fl">TRUE</span>, <span class="kw">winSize.noise</span> <span class="kw">=</span> <span class="fl">500</span>,
                <span class="kw">SNR.method</span> <span class="kw">=</span> <span class="st">"data.mean"</span>, <span class="kw">snthresh</span> <span class="kw">=</span> <span class="fl">10</span>)

<span class="no">ham_prep</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/chromatographic-peak-detection.html">findChromPeaks</a></span>(<span class="no">ham_raw</span>, <span class="kw">param</span> <span class="kw">=</span> <span class="no">msw</span>)

<span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span>(<span class="fu"><a href="../reference/XCMSnExp-class.html">chromPeaks</a></span>(<span class="no">ham_prep</span>))</pre></body></html></div>
<pre><code>##            mz    mzmin    mzmax rt rtmin rtmax    into     maxo       sn intf
## CP01 403.2367 403.2279 403.2447 -1    -1    -1 4735258 372259.4 22.97534   NA
## CP02 409.1845 409.1747 409.1936 -1    -1    -1 4158404 310572.1 20.61382   NA
## CP03 413.2677 413.2585 413.2769 -1    -1    -1 6099006 435462.6 27.21723   NA
## CP04 423.2363 423.2266 423.2459 -1    -1    -1 2708391 174252.7 14.74527   NA
## CP05 427.2681 427.2574 427.2779 -1    -1    -1 6302089 461385.6 32.50050   NA
## CP06 437.2375 437.2254 437.2488 -1    -1    -1 7523070 517917.6 34.37645   NA
##           maxf sample
## CP01  814693.1      1
## CP02  732119.9      1
## CP03 1018994.8      1
## CP04  435858.5      1
## CP05 1125644.3      1
## CP06 1282906.5      1</code></pre>
</div>
<div id="calibration" class="section level1">
<h1 class="hasAnchor">
<a href="#calibration" class="anchor"></a>Calibration</h1>
<p>The <code>calibrate</code> method can be used to correct the m/z values of identified peaks. The currently implemented method requires identified peaks and a list of m/z values for known calibrants. The identified peaks m/z values are then adjusted based on the differences between the calibrants’ m/z values and the m/z values of the closest peaks (within a user defined permitted maximal distance). Note that this method does presently only calibrate identified peaks, but not the original m/z values in the spectra.</p>
<p>Below we demonstrate the <code>calibrate</code> method on one of the data files with artificially defined calibration m/z values. We first subset the data set to the first data file, extract the m/z values of 3 peaks and modify the values slightly.</p>
<div class="sourceCode" id="cb7"><html><body><pre class="r"><span class="co">## Subset to the first file.</span>
<span class="no">first_file</span> <span class="kw">&lt;-</span> <span class="fu">filterFile</span>(<span class="no">ham_prep</span>, <span class="kw">file</span> <span class="kw">=</span> <span class="fl">1</span>)

<span class="co">## Extract 3 m/z values</span>
<span class="no">calib_mz</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/XCMSnExp-class.html">chromPeaks</a></span>(<span class="no">first_file</span>)[<span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fl">1</span>, <span class="fl">4</span>, <span class="fl">7</span>), <span class="st">"mz"</span>]
<span class="no">calib_mz</span> <span class="kw">&lt;-</span> <span class="no">calib_mz</span> + <span class="fl">0.00001</span> * <span class="fu"><a href="https://rdrr.io/r/stats/Uniform.html">runif</a></span>(<span class="fl">1</span>, <span class="fl">0</span>, <span class="fl">0.4</span>) * <span class="no">calib_mz</span> + <span class="fl">0.0001</span></pre></body></html></div>
<p>Next we calibrate the data set using the previously defined <em>artificial</em> calibrants. We are using the <code>"edgeshift"</code> method for calibration that adjusts all peaks within the range of the m/z values of the calibrants using a linear interpolation and shifts all chromatographic peaks outside of that range by a constant factor (the difference between the lowest respectively largest calibrant m/z with the closest peak’s m/z). Note that in a <em>real</em> use case, the m/z values would obviously represent known m/z of calibrants and would not be defined on the actual data.</p>
<div class="sourceCode" id="cb8"><html><body><pre class="r"><span class="co">## Set-up the parameter class for the calibration</span>
<span class="no">prm</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/calibrate-calibrant-mass.html">CalibrantMassParam</a></span>(<span class="kw">mz</span> <span class="kw">=</span> <span class="no">calib_mz</span>, <span class="kw">method</span> <span class="kw">=</span> <span class="st">"edgeshift"</span>,
                          <span class="kw">mzabs</span> <span class="kw">=</span> <span class="fl">0.0001</span>, <span class="kw">mzppm</span> <span class="kw">=</span> <span class="fl">5</span>)
<span class="no">first_file_calibrated</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/calibrate.html">calibrate</a></span>(<span class="no">first_file</span>, <span class="kw">param</span> <span class="kw">=</span> <span class="no">prm</span>)</pre></body></html></div>
<p>To evaluate the calibration we plot below the difference between the adjusted and raw m/z values (y-axis) against the raw m/z values.</p>
<div class="sourceCode" id="cb9"><html><body><pre class="r"><span class="no">diffs</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/XCMSnExp-class.html">chromPeaks</a></span>(<span class="no">first_file_calibrated</span>)[, <span class="st">"mz"</span>] -
    <span class="fu"><a href="../reference/XCMSnExp-class.html">chromPeaks</a></span>(<span class="no">first_file</span>)[, <span class="st">"mz"</span>]

<span class="fu"><a href="https://rdrr.io/r/base/plot.html">plot</a></span>(<span class="kw">x</span> <span class="kw">=</span> <span class="fu"><a href="../reference/XCMSnExp-class.html">chromPeaks</a></span>(<span class="no">first_file</span>)[, <span class="st">"mz"</span>], <span class="kw">xlab</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/expression.html">expression</a></span>(<span class="no">m</span>/<span class="no">z</span>[<span class="no">raw</span>]),
     <span class="kw">y</span> <span class="kw">=</span> <span class="no">diffs</span>, <span class="kw">ylab</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/expression.html">expression</a></span>(<span class="no">m</span>/<span class="no">z</span>[<span class="no">calibrated</span>] - <span class="no">m</span>/<span class="no">z</span>[<span class="no">raw</span>]))</pre></body></html></div>
<p><img src="xcms-direct-injection_files/figure-html/calibrationresult-1.png" width="576" style="display: block; margin: auto;"></p>
</div>
<div id="correspondence" class="section level1">
<h1 class="hasAnchor">
<a href="#correspondence" class="anchor"></a>Correspondence</h1>
<p>Correspondence aims to group peaks across samples to define the <em>features</em> (ions with the same m/z values). Peaks from single spectrum, direct injection MS experiments can be grouped with the <em>MZclust</em> method. Below we perform the correspondence analysis with the <code>groupChromPeaks</code> method using default settings.</p>
<div class="sourceCode" id="cb10"><html><body><pre class="r"><span class="co">## Using default settings but define sample group assignment</span>
<span class="no">mzc_prm</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/groupChromPeaks-mzClust.html">MzClustParam</a></span>(<span class="kw">sampleGroups</span> <span class="kw">=</span> <span class="no">ham_prep</span>$<span class="no">sample_group</span>)
<span class="no">ham_prep</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/groupChromPeaks.html">groupChromPeaks</a></span>(<span class="no">ham_prep</span>, <span class="kw">param</span> <span class="kw">=</span> <span class="no">mzc_prm</span>)</pre></body></html></div>
<p>Getting an overview of the performed processings:</p>
<div class="sourceCode" id="cb11"><html><body><pre class="r"><span class="no">ham_prep</span></pre></body></html></div>
<pre><code>## MSn experiment data ("XCMSnExp")
## Object size in memory: 0.05 Mb
## - - - Spectra data - - -
##  MS level(s): 1 
##  Number of spectra: 10 
##  MSn retention times: 0:1 - 0:1 minutes
## - - - Processing information - - -
## Data loaded [Wed May 20 05:39:59 2020] 
##  MSnbase version: 2.14.2 
## - - - Meta data  - - -
## phenoData
##   rowNames: 1 2 ... 10 (10 total)
##   varLabels: filename sample_group
##   varMetadata: labelDescription
## Loaded from:
##   [1] HAM004_641fE_14-11-07--Exp1.extracted.mzdata...  [10] HAM005_641fE_14-11-07--Exp5.extracted.mzdata
##   Use 'fileNames(.)' to see all files.
## protocolData: none
## featureData
##   featureNames: F01.S1 F02.S1 ... F10.S1 (10 total)
##   fvarLabels: fileIdx spIdx ... spectrum (35 total)
##   fvarMetadata: labelDescription
## experimentData: use 'experimentData(object)'
## - - - xcms preprocessing - - -
## Chromatographic peak detection:
##  method: MSW 
##  88 peaks identified in 10 samples.
##  On average 8.8 chromatographic peaks per sample.
## Correspondence:
##  method: mzClust 
##  18 features identified.
##  Median mz range of features: 0.00088501
##  Median rt range of features: 0</code></pre>
<p>The peak group information, i.e. the <em>feature</em> definitions can be accessed with the <code>featureDefinitions</code> method.</p>
<div class="sourceCode" id="cb13"><html><body><pre class="r"><span class="fu"><a href="../reference/XCMSnExp-class.html">featureDefinitions</a></span>(<span class="no">ham_prep</span>)</pre></body></html></div>
<pre><code>## DataFrame with 18 rows and 10 columns
##          mzmed     mzmin     mzmax     rtmed     rtmin     rtmax    npeaks
##      &lt;numeric&gt; &lt;numeric&gt; &lt;numeric&gt; &lt;numeric&gt; &lt;numeric&gt; &lt;numeric&gt; &lt;numeric&gt;
## FT01   402.285   402.285   402.286        -1        -1        -1         5
## FT02   403.237   403.236   403.237        -1        -1        -1         9
## FT03   405.109   405.109   405.110        -1        -1        -1         4
## FT04   409.184   409.184   409.185        -1        -1        -1         5
## FT05   410.144   410.144   410.145        -1        -1        -1         4
## ...        ...       ...       ...       ...       ...       ...       ...
## FT14   438.241   438.240   438.241        -1        -1        -1         3
## FT15   439.151   439.150   439.151        -1        -1        -1         5
## FT16   441.130   441.130   441.131        -1        -1        -1         3
## FT17   444.130   444.129   444.130        -1        -1        -1         3
## FT18   445.293   445.292   445.293        -1        -1        -1         4
##           ham4      ham5      peakidx
##      &lt;numeric&gt; &lt;numeric&gt;       &lt;list&gt;
## FT01         0         5 37,60,80,...
## FT02         5         4 61,38,50,...
## FT03         0         4 39,51,62,...
## FT04         5         0  10,2,17,...
## FT05         0         4 40,72,52,...
## ...        ...       ...          ...
## FT14         3         0      7,14,22
## FT15         0         5 67,86,47,...
## FT16         0         3     59,87,48
## FT17         0         3     68,79,88
## FT18         4         0  15,8,30,...</code></pre>
<p>Plotting the raw data for direct injection samples involves a little more processing than for LC/GC-MS data in which we can simply use the <code>chromatogram</code> method to extract the data. Below we extract the m/z-intensity pairs for the peaks associated with the first feature. We thus first identify the peaks for that feature and define their m/z values range. Using this range we can subsequently use the <code>filterMz</code> function to sub-set the full data set to the signal associated with the feature’s peaks. On that object we can then call the <code>mz</code> and <code>intensity</code> functions to extract the data.</p>
<div class="sourceCode" id="cb15"><html><body><pre class="r"><span class="co">## Get the peaks belonging to the first feature</span>
<span class="no">pks</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/XCMSnExp-class.html">chromPeaks</a></span>(<span class="no">ham_prep</span>)[<span class="fu"><a href="../reference/XCMSnExp-class.html">featureDefinitions</a></span>(<span class="no">ham_prep</span>)$<span class="no">peakidx</span><span class="kw">[[</span><span class="fl">1</span>]], ]

<span class="co">## Define the m/z range</span>
<span class="no">mzr</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">min</a></span>(<span class="no">pks</span>[, <span class="st">"mzmin"</span>]) - <span class="fl">0.001</span>, <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">max</a></span>(<span class="no">pks</span>[, <span class="st">"mzmax"</span>]) + <span class="fl">0.001</span>)

<span class="co">## Subset the object to the m/z range</span>
<span class="no">ham_prep_sub</span> <span class="kw">&lt;-</span> <span class="fu">filterMz</span>(<span class="no">ham_prep</span>, <span class="kw">mz</span> <span class="kw">=</span> <span class="no">mzr</span>)

<span class="co">## Extract the mz and intensity values</span>
<span class="no">mzs</span> <span class="kw">&lt;-</span> <span class="fu">mz</span>(<span class="no">ham_prep_sub</span>, <span class="kw">bySample</span> <span class="kw">=</span> <span class="fl">TRUE</span>)
<span class="no">ints</span> <span class="kw">&lt;-</span> <span class="fu">intensity</span>(<span class="no">ham_prep_sub</span>, <span class="kw">bySample</span> <span class="kw">=</span> <span class="fl">TRUE</span>)

<span class="co">## Plot the data</span>
<span class="fu"><a href="https://rdrr.io/r/base/plot.html">plot</a></span>(<span class="fl">3</span>, <span class="fl">3</span>, <span class="kw">pch</span> <span class="kw">=</span> <span class="fl">NA</span>, <span class="kw">xlim</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/range.html">range</a></span>(<span class="no">mzs</span>), <span class="kw">ylim</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/range.html">range</a></span>(<span class="no">ints</span>), <span class="kw">main</span> <span class="kw">=</span> <span class="st">"FT01"</span>,
     <span class="kw">xlab</span> <span class="kw">=</span> <span class="st">"m/z"</span>, <span class="kw">ylab</span> <span class="kw">=</span> <span class="st">"intensity"</span>)
<span class="co">## Define colors</span>
<span class="no">cols</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span>(<span class="st">"#ff000080"</span>, <span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span>(<span class="no">mzs</span>))
<span class="no">cols</span>[<span class="no">ham_prep_sub</span>$<span class="no">sample_group</span> <span class="kw">==</span> <span class="st">"ham5"</span>] <span class="kw">&lt;-</span> <span class="st">"#0000ff80"</span>
<span class="no">tmp</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/mapply.html">mapply</a></span>(<span class="no">mzs</span>, <span class="no">ints</span>, <span class="no">cols</span>, <span class="kw">FUN</span> <span class="kw">=</span> <span class="kw">function</span>(<span class="no">x</span>, <span class="no">y</span>, <span class="no">col</span>) {
    <span class="fu"><a href="https://rdrr.io/r/graphics/points.html">points</a></span>(<span class="no">x</span>, <span class="no">y</span>, <span class="kw">col</span> <span class="kw">=</span> <span class="no">col</span>, <span class="kw">type</span> <span class="kw">=</span> <span class="st">"l"</span>)
})</pre></body></html></div>
<p><img src="xcms-direct-injection_files/figure-html/feature1-1.png" width="576" style="display: block; margin: auto;"></p>
<p>To access the actual intensity values of each feature in each sample the <code>featureValue</code> method can be used. The setting <code>value = "into"</code> tells the function to return the integrated signal for each peak (one representative peak) per sample.</p>
<div class="sourceCode" id="cb16"><html><body><pre class="r"><span class="no">feat_vals</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/XCMSnExp-peak-grouping-results.html">featureValues</a></span>(<span class="no">ham_prep</span>, <span class="kw">value</span> <span class="kw">=</span> <span class="st">"into"</span>)
<span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span>(<span class="no">feat_vals</span>)</pre></body></html></div>
<pre><code>##      HAM004_641fE_14-11-07--Exp1.extracted.mzdata
## FT01                                           NA
## FT02                                      4735258
## FT03                                           NA
## FT04                                      4158404
## FT05                                           NA
## FT06                                      6099006
##      HAM004_641fE_14-11-07--Exp2.extracted.mzdata
## FT01                                           NA
## FT02                                      6202418
## FT03                                           NA
## FT04                                      5004546
## FT05                                           NA
## FT06                                      4950642
##      HAM004_641fE_14-11-07--Exp3.extracted.mzdata
## FT01                                           NA
## FT02                                      6117414
## FT03                                           NA
## FT04                                      4403588
## FT05                                           NA
## FT06                                      5517710
##      HAM004_641fE_14-11-07--Exp4.extracted.mzdata
## FT01                                           NA
## FT02                                      5328574
## FT03                                           NA
## FT04                                      4336554
## FT05                                           NA
## FT06                                      5008542
##      HAM004_641fE_14-11-07--Exp5.extracted.mzdata
## FT01                                           NA
## FT02                                      6429029
## FT03                                           NA
## FT04                                      4580893
## FT05                                           NA
## FT06                                      4856606
##      HAM005_641fE_14-11-07--Exp1.extracted.mzdata
## FT01                                      4095293
## FT02                                      4811391
## FT03                                      2982453
## FT04                                           NA
## FT05                                      2872023
## FT06                                           NA
##      HAM005_641fE_14-11-07--Exp2.extracted.mzdata
## FT01                                      4804763
## FT02                                      2581183
## FT03                                      2268984
## FT04                                           NA
## FT05                                      2133219
## FT06                                           NA
##      HAM005_641fE_14-11-07--Exp3.extracted.mzdata
## FT01                                      4657727
## FT02                                      2727237
## FT03                                      2971705
## FT04                                           NA
## FT05                                      2466626
## FT06                                           NA
##      HAM005_641fE_14-11-07--Exp4.extracted.mzdata
## FT01                                      3755890
## FT02                                      2496859
## FT03                                           NA
## FT04                                           NA
## FT05                                      2980997
## FT06                                           NA
##      HAM005_641fE_14-11-07--Exp5.extracted.mzdata
## FT01                                      5265972
## FT02                                           NA
## FT03                                      3009065
## FT04                                           NA
## FT05                                           NA
## FT06                                           NA</code></pre>
<p><code>NA</code> is reported for features in samples for which no peak was identified at the feature’s m/z value. In some instances there might still be a signal at the feature’s position in the raw data files, but the peak detection failed to identify a peak. For these cases signal can be recovered using the <code>fillChromPeaks</code> method that integrates all raw signal at the feature’s location. If there is no signal at that location an <code>NA</code> is reported.</p>
<div class="sourceCode" id="cb18"><html><body><pre class="r"><span class="no">ham_prep</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/fillChromPeaks.html">fillChromPeaks</a></span>(<span class="no">ham_prep</span>, <span class="kw">param</span> <span class="kw">=</span> <span class="fu"><a href="../reference/fillChromPeaks.html">FillChromPeaksParam</a></span>())

<span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span>(<span class="fu"><a href="../reference/XCMSnExp-peak-grouping-results.html">featureValues</a></span>(<span class="no">ham_prep</span>, <span class="kw">value</span> <span class="kw">=</span> <span class="st">"into"</span>))</pre></body></html></div>
<pre><code>##      HAM004_641fE_14-11-07--Exp1.extracted.mzdata
## FT01                                     751860.7
## FT02                                    4735257.5
## FT03                                     749756.9
## FT04                                    4158404.5
## FT05                                     707975.5
## FT06                                    6099006.3
##      HAM004_641fE_14-11-07--Exp2.extracted.mzdata
## FT01                                    1202735.5
## FT02                                    6202417.6
## FT03                                     450339.0
## FT04                                    5004546.3
## FT05                                     481158.4
## FT06                                    4950641.7
##      HAM004_641fE_14-11-07--Exp3.extracted.mzdata
## FT01                                     779492.4
## FT02                                    6117414.1
## FT03                                     588609.5
## FT04                                    4403588.2
## FT05                                    1149542.8
## FT06                                    5517709.5
##      HAM004_641fE_14-11-07--Exp4.extracted.mzdata
## FT01                                     541406.3
## FT02                                    5328574.1
## FT03                                     877991.1
## FT04                                    4336554.2
## FT05                                     798341.5
## FT06                                    5008541.7
##      HAM004_641fE_14-11-07--Exp5.extracted.mzdata
## FT01                                     543921.1
## FT02                                    6429028.9
## FT03                                    1363759.7
## FT04                                    4580892.8
## FT05                                    1107571.1
## FT06                                    4856606.0
##      HAM005_641fE_14-11-07--Exp1.extracted.mzdata
## FT01                                      4095293
## FT02                                      4811391
## FT03                                      2982453
## FT04                                      1174152
## FT05                                      2872023
## FT06                                      1708432
##      HAM005_641fE_14-11-07--Exp2.extracted.mzdata
## FT01                                      4804763
## FT02                                      2581183
## FT03                                      2268984
## FT04                                      1183772
## FT05                                      2133219
## FT06                                      1037441
##      HAM005_641fE_14-11-07--Exp3.extracted.mzdata
## FT01                                    4657726.8
## FT02                                    2727237.5
## FT03                                    2971705.2
## FT04                                     517915.7
## FT05                                    2466625.6
## FT06                                     867137.8
##      HAM005_641fE_14-11-07--Exp4.extracted.mzdata
## FT01                                    3755889.7
## FT02                                    2496858.9
## FT03                                    2291624.1
## FT04                                    1321138.8
## FT05                                    2980996.6
## FT06                                     947289.2
##      HAM005_641fE_14-11-07--Exp5.extracted.mzdata
## FT01                                      5265972
## FT02                                      2128723
## FT03                                      3009065
## FT04                                      1163582
## FT05                                      2227016
## FT06                                      1006506</code></pre>
</div>
<div id="further-analysis" class="section level1">
<h1 class="hasAnchor">
<a href="#further-analysis" class="anchor"></a>Further analysis</h1>
<p>Further analysis, i.e. detection of features/metabolites with significantly different abundances, or PCA analyses can be performed on the feature matrix using functionality from other R packages, such as <em><a href="https://bioconductor.org/packages/3.11/limma">limma</a></em>.</p>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p>Developed by Steffen Neumann.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.5.1.9000.</p>
</div>

      </footer>
</div>

  


  </body>
</html>
