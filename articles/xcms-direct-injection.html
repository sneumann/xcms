<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Grouping FTICR-MS data with xcms • xcms</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Grouping FTICR-MS data with xcms">
<meta property="og:description" content="xcms">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    

    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">xcms</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">3.21.1</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../articles/xcms.html">Get started</a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/LC-MS-feature-grouping.html">Compounding (grouping) of LC-MS features</a>
    </li>
    <li>
      <a href="../articles/xcms-direct-injection.html">Grouping FTICR-MS data with xcms</a>
    </li>
    <li>
      <a href="../articles/xcms-lcms-ms.html">LC-MS/MS data analysis with xcms</a>
    </li>
  </ul>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/sneumann/xcms/" class="external-link">
    <span class="fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Grouping FTICR-MS data with xcms</h1>
                        <h4 data-toc-skip class="author">Joachim
Bargsten</h4>
                                    <h4 data-toc-skip class="author">Johannes
Rainer</h4>
                        
      
      <small class="dont-index">Source: <a href="https://github.com/sneumann/xcms/blob/HEAD/vignettes/xcms-direct-injection.Rmd" class="external-link"><code>vignettes/xcms-direct-injection.Rmd</code></a></small>
      <div class="hidden name"><code>xcms-direct-injection.Rmd</code></div>

    </div>

    
    
<script type="text/javascript">
document.addEventListener("DOMContentLoaded", function() {
  document.querySelector("h1").className = "title";
});
</script><script type="text/javascript">
document.addEventListener("DOMContentLoaded", function() {
  var links = document.links;  
  for (var i = 0, linksLength = links.length; i < linksLength; i++)
    if (links[i].hostname != window.location.hostname)
      links[i].target = '_blank';
});
</script><div class="section level2">
<h2 id="introduction">Introduction<a class="anchor" aria-label="anchor" href="#introduction"></a>
</h2>
<p>This document describes how to use <em><a href="https://bioconductor.org/packages/3.17/xcms" class="external-link">xcms</a></em> for the
analysis of direct injection mass spec data, including peak detection,
calibration and correspondence (grouping of peaks across samples).</p>
</div>
<div class="section level2">
<h2 id="peak-detection">Peak detection<a class="anchor" aria-label="anchor" href="#peak-detection"></a>
</h2>
<p>Prior to any other analysis step, peaks have to be identified in the
mass spec data. In contrast to the typical metabolomics workflow, in
which peaks are identified in the chromatographic (time) dimension, in
direct injection mass spec data sets peaks are identified in the m/z
dimension. <em><a href="https://bioconductor.org/packages/3.17/xcms" class="external-link">xcms</a></em> uses
functionality from the <code>MassSpecWavelet</code> package to identify
such peaks.</p>
<p>Below we load the required packages. For information on the parallel
processing setup please see the <code>BiocParallel</code> vignette.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/sneumann/xcms" class="external-link">xcms</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/zeehio/MassSpecWavelet" class="external-link">MassSpecWavelet</a></span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/BiocParallel/man/register.html" class="external-link">register</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/BiocParallel/man/SerialParam-class.html" class="external-link">SerialParam</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p>In this documentation we use an example data set from the <em><a href="https://bioconductor.org/packages/3.17/msdata" class="external-link">msdata</a></em>
package. Assuming that <em><a href="https://bioconductor.org/packages/3.17/msdata" class="external-link">msdata</a></em> is
installed, we locate the path of the package and load the data set. We
create also a <code>data.frame</code> describing the experimental setup
based on the file names.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">mzML_path</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span><span class="st">"fticr-mzML"</span>, package <span class="op">=</span> <span class="st">"msdata"</span><span class="op">)</span></span>
<span><span class="va">mzML_files</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.files.html" class="external-link">list.files</a></span><span class="op">(</span><span class="va">mzML_path</span>, recursive <span class="op">=</span> <span class="cn">TRUE</span>, full.names <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span></span>
<span><span class="co">## We're subsetting to 2 samples per condition</span></span>
<span><span class="va">mzML_files</span> <span class="op">&lt;-</span> <span class="va">mzML_files</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">2</span>, <span class="fl">6</span>, <span class="fl">7</span><span class="op">)</span><span class="op">]</span></span>
<span></span>
<span><span class="co">## Create a data.frame assigning samples to sample groups, i.e. ham4 and ham5.</span></span>
<span><span class="va">grp</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="st">"ham4"</span>, <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">mzML_files</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">grp</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/pkg/BiocGenerics/man/grep.html" class="external-link">grep</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/BiocGenerics/man/path.html" class="external-link">basename</a></span><span class="op">(</span><span class="va">mzML_files</span><span class="op">)</span>, pattern <span class="op">=</span> <span class="st">"^HAM005"</span><span class="op">)</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="st">"ham5"</span></span>
<span><span class="va">pd</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>filename <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/BiocGenerics/man/path.html" class="external-link">basename</a></span><span class="op">(</span><span class="va">mzML_files</span><span class="op">)</span>, sample_group <span class="op">=</span> <span class="va">grp</span><span class="op">)</span></span>
<span></span>
<span><span class="co">## Load the data.</span></span>
<span><span class="va">ham_raw</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://lgatto.github.io/MSnbase/reference/readMSData.html" class="external-link">readMSData</a></span><span class="op">(</span>files <span class="op">=</span> <span class="va">mzML_files</span>,</span>
<span>                      pdata <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/methods/new.html" class="external-link">new</a></span><span class="op">(</span><span class="st">"NAnnotatedDataFrame"</span>, <span class="va">pd</span><span class="op">)</span>,</span>
<span>                      mode <span class="op">=</span> <span class="st">"onDisk"</span><span class="op">)</span></span></code></pre></div>
<p>The data files are from <em>direct injection</em> mass spectrometry
experiments, i.e. we have only a single spectrum available for each
sample and no retention times.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">## Only a single spectrum with an *artificial* retention time is available</span></span>
<span><span class="co">## for each sample</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/ProtGenerics/man/protgenerics.html" class="external-link">rtime</a></span><span class="op">(</span><span class="va">ham_raw</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## F1.S1 F2.S1 F3.S1 F4.S1 </span></span>
<span><span class="co">##    -1    -1    -1    -1</span></span></code></pre>
<p>Peaks are identified within each spectrum using the <em>mass spec
wavelet</em> method.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">## Define the parameters for the peak detection</span></span>
<span><span class="va">msw</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/findPeaks-MSW.html">MSWParam</a></span><span class="op">(</span>scales <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">4</span>, <span class="fl">9</span><span class="op">)</span>, nearbyPeak <span class="op">=</span> <span class="cn">TRUE</span>, winSize.noise <span class="op">=</span> <span class="fl">500</span>,</span>
<span>                SNR.method <span class="op">=</span> <span class="st">"data.mean"</span>, snthresh <span class="op">=</span> <span class="fl">10</span><span class="op">)</span></span>
<span></span>
<span><span class="va">ham_prep</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/chromatographic-peak-detection.html">findChromPeaks</a></span><span class="op">(</span><span class="va">ham_raw</span>, param <span class="op">=</span> <span class="va">msw</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="fu"><a href="../reference/XCMSnExp-class.html">chromPeaks</a></span><span class="op">(</span><span class="va">ham_prep</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">##            mz    mzmin    mzmax rt rtmin rtmax    into     maxo       sn intf</span></span>
<span><span class="co">## CP01 403.2367 403.2279 403.2447 -1    -1    -1 4735258 372259.4 22.97534   NA</span></span>
<span><span class="co">## CP02 409.1845 409.1747 409.1936 -1    -1    -1 4158404 310572.1 20.61382   NA</span></span>
<span><span class="co">## CP03 413.2677 413.2585 413.2769 -1    -1    -1 6099006 435462.6 27.21723   NA</span></span>
<span><span class="co">## CP04 423.2363 423.2266 423.2459 -1    -1    -1 2708391 174252.7 14.74527   NA</span></span>
<span><span class="co">## CP05 427.2681 427.2574 427.2779 -1    -1    -1 6302089 461385.6 32.50050   NA</span></span>
<span><span class="co">## CP06 437.2375 437.2254 437.2488 -1    -1    -1 7523070 517917.6 34.37645   NA</span></span>
<span><span class="co">##           maxf sample</span></span>
<span><span class="co">## CP01  814693.1      1</span></span>
<span><span class="co">## CP02  732119.9      1</span></span>
<span><span class="co">## CP03 1018994.8      1</span></span>
<span><span class="co">## CP04  435858.5      1</span></span>
<span><span class="co">## CP05 1125644.3      1</span></span>
<span><span class="co">## CP06 1282906.5      1</span></span></code></pre>
</div>
<div class="section level2">
<h2 id="calibration">Calibration<a class="anchor" aria-label="anchor" href="#calibration"></a>
</h2>
<p>The <code>calibrate</code> method can be used to correct the m/z
values of identified peaks. The currently implemented method requires
identified peaks and a list of m/z values for known calibrants. The
identified peaks m/z values are then adjusted based on the differences
between the calibrants’ m/z values and the m/z values of the closest
peaks (within a user defined permitted maximal distance). Note that this
method does presently only calibrate identified peaks, but not the
original m/z values in the spectra.</p>
<p>Below we demonstrate the <code>calibrate</code> method on one of the
data files with artificially defined calibration m/z values. We first
subset the data set to the first data file, extract the m/z values of 3
peaks and modify the values slightly.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">## Subset to the first file.</span></span>
<span><span class="va">first_file</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://lgatto.github.io/MSnbase/reference/MSnExp-class.html" class="external-link">filterFile</a></span><span class="op">(</span><span class="va">ham_prep</span>, file <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></span>
<span></span>
<span><span class="co">## Extract 3 m/z values</span></span>
<span><span class="va">calib_mz</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/XCMSnExp-class.html">chromPeaks</a></span><span class="op">(</span><span class="va">first_file</span><span class="op">)</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">4</span>, <span class="fl">7</span><span class="op">)</span>, <span class="st">"mz"</span><span class="op">]</span></span>
<span><span class="va">calib_mz</span> <span class="op">&lt;-</span> <span class="va">calib_mz</span> <span class="op">+</span> <span class="fl">0.00001</span> <span class="op">*</span> <span class="fu"><a href="https://rdrr.io/r/stats/Uniform.html" class="external-link">runif</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">0</span>, <span class="fl">0.4</span><span class="op">)</span> <span class="op">*</span> <span class="va">calib_mz</span> <span class="op">+</span> <span class="fl">0.0001</span></span></code></pre></div>
<p>Next we calibrate the data set using the previously defined
<em>artificial</em> calibrants. We are using the
<code>"edgeshift"</code> method for calibration that adjusts all peaks
within the range of the m/z values of the calibrants using a linear
interpolation and shifts all chromatographic peaks outside of that range
by a constant factor (the difference between the lowest respectively
largest calibrant m/z with the closest peak’s m/z). Note that in a
<em>real</em> use case, the m/z values would obviously represent known
m/z of calibrants and would not be defined on the actual data.</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">## Set-up the parameter class for the calibration</span></span>
<span><span class="va">prm</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/calibrate-calibrant-mass.html">CalibrantMassParam</a></span><span class="op">(</span>mz <span class="op">=</span> <span class="va">calib_mz</span>, method <span class="op">=</span> <span class="st">"edgeshift"</span>,</span>
<span>                          mzabs <span class="op">=</span> <span class="fl">0.0001</span>, mzppm <span class="op">=</span> <span class="fl">5</span><span class="op">)</span></span>
<span><span class="va">first_file_calibrated</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/calibrate.html">calibrate</a></span><span class="op">(</span><span class="va">first_file</span>, param <span class="op">=</span> <span class="va">prm</span><span class="op">)</span></span></code></pre></div>
<p>To evaluate the calibration we plot below the difference between the
adjusted and raw m/z values (y-axis) against the raw m/z values.</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">diffs</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/XCMSnExp-class.html">chromPeaks</a></span><span class="op">(</span><span class="va">first_file_calibrated</span><span class="op">)</span><span class="op">[</span>, <span class="st">"mz"</span><span class="op">]</span> <span class="op">-</span></span>
<span>    <span class="fu"><a href="../reference/XCMSnExp-class.html">chromPeaks</a></span><span class="op">(</span><span class="va">first_file</span><span class="op">)</span><span class="op">[</span>, <span class="st">"mz"</span><span class="op">]</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/plot.html" class="external-link">plot</a></span><span class="op">(</span>x <span class="op">=</span> <span class="fu"><a href="../reference/XCMSnExp-class.html">chromPeaks</a></span><span class="op">(</span><span class="va">first_file</span><span class="op">)</span><span class="op">[</span>, <span class="st">"mz"</span><span class="op">]</span>, xlab <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/expression.html" class="external-link">expression</a></span><span class="op">(</span><span class="va">m</span><span class="op">/</span><span class="va">z</span><span class="op">[</span><span class="va">raw</span><span class="op">]</span><span class="op">)</span>,</span>
<span>     y <span class="op">=</span> <span class="va">diffs</span>, ylab <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/expression.html" class="external-link">expression</a></span><span class="op">(</span><span class="va">m</span><span class="op">/</span><span class="va">z</span><span class="op">[</span><span class="va">calibrated</span><span class="op">]</span> <span class="op">-</span> <span class="va">m</span><span class="op">/</span><span class="va">z</span><span class="op">[</span><span class="va">raw</span><span class="op">]</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p><img src="xcms-direct-injection_files/figure-html/calibrationresult-1.png" width="576" style="display: block; margin: auto;"></p>
</div>
<div class="section level2">
<h2 id="correspondence">Correspondence<a class="anchor" aria-label="anchor" href="#correspondence"></a>
</h2>
<p>Correspondence aims to group peaks across samples to define the
<em>features</em> (ions with the same m/z values). Peaks from single
spectrum, direct injection MS experiments can be grouped with the
<em>MZclust</em> method. Below we perform the correspondence analysis
with the <code>groupChromPeaks</code> method using default settings.</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">## Using default settings but define sample group assignment</span></span>
<span><span class="va">mzc_prm</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/groupChromPeaks-mzClust.html">MzClustParam</a></span><span class="op">(</span>sampleGroups <span class="op">=</span> <span class="va">ham_prep</span><span class="op">$</span><span class="va">sample_group</span><span class="op">)</span></span>
<span><span class="va">ham_prep</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/groupChromPeaks.html">groupChromPeaks</a></span><span class="op">(</span><span class="va">ham_prep</span>, param <span class="op">=</span> <span class="va">mzc_prm</span><span class="op">)</span></span></code></pre></div>
<p>Getting an overview of the performed processings:</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">ham_prep</span></span></code></pre></div>
<pre><code><span><span class="co">## MSn experiment data ("XCMSnExp")</span></span>
<span><span class="co">## Object size in memory: 0.04 Mb</span></span>
<span><span class="co">## - - - Spectra data - - -</span></span>
<span><span class="co">##  MS level(s): 1 </span></span>
<span><span class="co">##  Number of spectra: 4 </span></span>
<span><span class="co">##  MSn retention times: -1:59 - -1:59 minutes</span></span>
<span><span class="co">## - - - Processing information - - -</span></span>
<span><span class="co">## Data loaded [Mon Jan 16 12:15:44 2023] </span></span>
<span><span class="co">##  MSnbase version: 2.25.1 </span></span>
<span><span class="co">## - - - Meta data  - - -</span></span>
<span><span class="co">## phenoData</span></span>
<span><span class="co">##   rowNames: 1 2 3 4</span></span>
<span><span class="co">##   varLabels: filename sample_group</span></span>
<span><span class="co">##   varMetadata: labelDescription</span></span>
<span><span class="co">## Loaded from:</span></span>
<span><span class="co">##   [1] HAM004_641fE_14-11-07--Exp1.extracted.mzML...  [4] HAM005_641fE_14-11-07--Exp2.extracted.mzML</span></span>
<span><span class="co">##   Use 'fileNames(.)' to see all files.</span></span>
<span><span class="co">## protocolData: none</span></span>
<span><span class="co">## featureData</span></span>
<span><span class="co">##   featureNames: F1.S1 F2.S1 F3.S1 F4.S1</span></span>
<span><span class="co">##   fvarLabels: fileIdx spIdx ... spectrum (35 total)</span></span>
<span><span class="co">##   fvarMetadata: labelDescription</span></span>
<span><span class="co">## experimentData: use 'experimentData(object)'</span></span>
<span><span class="co">## - - - xcms preprocessing - - -</span></span>
<span><span class="co">## Chromatographic peak detection:</span></span>
<span><span class="co">##  method: MSW </span></span>
<span><span class="co">##  38 peaks identified in 4 samples.</span></span>
<span><span class="co">##  On average 9.5 chromatographic peaks per sample.</span></span>
<span><span class="co">## Correspondence:</span></span>
<span><span class="co">##  method: mzClust </span></span>
<span><span class="co">##  20 features identified.</span></span>
<span><span class="co">##  Median mz range of features: 9.1553e-05</span></span>
<span><span class="co">##  Median rt range of features: 0</span></span></code></pre>
<p>The peak group information, i.e. the <em>feature</em> definitions can
be accessed with the <code>featureDefinitions</code> method.</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/XCMSnExp-class.html">featureDefinitions</a></span><span class="op">(</span><span class="va">ham_prep</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## DataFrame with 20 rows and 10 columns</span></span>
<span><span class="co">##          mzmed     mzmin     mzmax     rtmed     rtmin     rtmax    npeaks</span></span>
<span><span class="co">##      &lt;numeric&gt; &lt;numeric&gt; &lt;numeric&gt; &lt;numeric&gt; &lt;numeric&gt; &lt;numeric&gt; &lt;numeric&gt;</span></span>
<span><span class="co">## FT01   402.285   402.285   402.286        -1        -1        -1         2</span></span>
<span><span class="co">## FT02   403.237   403.237   403.237        -1        -1        -1         4</span></span>
<span><span class="co">## FT03   405.109   405.109   405.109        -1        -1        -1         2</span></span>
<span><span class="co">## FT04   409.184   409.184   409.185        -1        -1        -1         2</span></span>
<span><span class="co">## FT05   410.144   410.144   410.145        -1        -1        -1         2</span></span>
<span><span class="co">## ...        ...       ...       ...       ...       ...       ...       ...</span></span>
<span><span class="co">## FT16   437.238   437.238   437.238        -1        -1        -1         2</span></span>
<span><span class="co">## FT17   438.240   438.240   438.240        -1        -1        -1         2</span></span>
<span><span class="co">## FT18   439.151   439.151   439.151        -1        -1        -1         2</span></span>
<span><span class="co">## FT19   441.130   441.130   441.131        -1        -1        -1         2</span></span>
<span><span class="co">## FT20   445.293   445.292   445.293        -1        -1        -1         2</span></span>
<span><span class="co">##           ham4      ham5     peakidx</span></span>
<span><span class="co">##      &lt;numeric&gt; &lt;numeric&gt;      &lt;list&gt;</span></span>
<span><span class="co">## FT01         0         2       16,28</span></span>
<span><span class="co">## FT02         2         2 17,29,1,...</span></span>
<span><span class="co">## FT03         0         2       18,30</span></span>
<span><span class="co">## FT04         2         0        10,2</span></span>
<span><span class="co">## FT05         0         2       19,31</span></span>
<span><span class="co">## ...        ...       ...         ...</span></span>
<span><span class="co">## FT16         2         0        6,13</span></span>
<span><span class="co">## FT17         2         0        7,14</span></span>
<span><span class="co">## FT18         0         2       26,37</span></span>
<span><span class="co">## FT19         0         2       38,27</span></span>
<span><span class="co">## FT20         2         0        15,8</span></span></code></pre>
<p>Plotting the raw data for direct injection samples involves a little
more processing than for LC/GC-MS data in which we can simply use the
<code>chromatogram</code> method to extract the data. Below we extract
the m/z-intensity pairs for the peaks associated with the first feature.
We thus first identify the peaks for that feature and define their m/z
values range. Using this range we can subsequently use the
<code>filterMz</code> function to sub-set the full data set to the
signal associated with the feature’s peaks. On that object we can then
call the <code>mz</code> and <code>intensity</code> functions to extract
the data.</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">## Get the peaks belonging to the first feature</span></span>
<span><span class="va">pks</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/XCMSnExp-class.html">chromPeaks</a></span><span class="op">(</span><span class="va">ham_prep</span><span class="op">)</span><span class="op">[</span><span class="fu"><a href="../reference/XCMSnExp-class.html">featureDefinitions</a></span><span class="op">(</span><span class="va">ham_prep</span><span class="op">)</span><span class="op">$</span><span class="va">peakidx</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span>, <span class="op">]</span></span>
<span></span>
<span><span class="co">## Define the m/z range</span></span>
<span><span class="va">mzr</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">min</a></span><span class="op">(</span><span class="va">pks</span><span class="op">[</span>, <span class="st">"mzmin"</span><span class="op">]</span><span class="op">)</span> <span class="op">-</span> <span class="fl">0.001</span>, <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">max</a></span><span class="op">(</span><span class="va">pks</span><span class="op">[</span>, <span class="st">"mzmax"</span><span class="op">]</span><span class="op">)</span> <span class="op">+</span> <span class="fl">0.001</span><span class="op">)</span></span>
<span></span>
<span><span class="co">## Subset the object to the m/z range</span></span>
<span><span class="va">ham_prep_sub</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/ProtGenerics/man/protgenerics.html" class="external-link">filterMz</a></span><span class="op">(</span><span class="va">ham_prep</span>, mz <span class="op">=</span> <span class="va">mzr</span><span class="op">)</span></span>
<span></span>
<span><span class="co">## Extract the mz and intensity values</span></span>
<span><span class="va">mzs</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/ProtGenerics/man/protgenerics.html" class="external-link">mz</a></span><span class="op">(</span><span class="va">ham_prep_sub</span>, bySample <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="va">ints</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/ProtGenerics/man/protgenerics.html" class="external-link">intensity</a></span><span class="op">(</span><span class="va">ham_prep_sub</span>, bySample <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span></span>
<span><span class="co">## Plot the data</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/plot.html" class="external-link">plot</a></span><span class="op">(</span><span class="fl">3</span>, <span class="fl">3</span>, pch <span class="op">=</span> <span class="cn">NA</span>, xlim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/range.html" class="external-link">range</a></span><span class="op">(</span><span class="va">mzs</span><span class="op">)</span>, ylim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/range.html" class="external-link">range</a></span><span class="op">(</span><span class="va">ints</span><span class="op">)</span>, main <span class="op">=</span> <span class="st">"FT01"</span>,</span>
<span>     xlab <span class="op">=</span> <span class="st">"m/z"</span>, ylab <span class="op">=</span> <span class="st">"intensity"</span><span class="op">)</span></span>
<span><span class="co">## Define colors</span></span>
<span><span class="va">cols</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="st">"#ff000080"</span>, <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">mzs</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">cols</span><span class="op">[</span><span class="va">ham_prep_sub</span><span class="op">$</span><span class="va">sample_group</span> <span class="op">==</span> <span class="st">"ham5"</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="st">"#0000ff80"</span></span>
<span><span class="va">tmp</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/BiocGenerics/man/mapply.html" class="external-link">mapply</a></span><span class="op">(</span><span class="va">mzs</span>, <span class="va">ints</span>, <span class="va">cols</span>, FUN <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span>, <span class="va">y</span>, <span class="va">col</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/graphics/points.html" class="external-link">points</a></span><span class="op">(</span><span class="va">x</span>, <span class="va">y</span>, col <span class="op">=</span> <span class="va">col</span>, type <span class="op">=</span> <span class="st">"l"</span><span class="op">)</span></span>
<span><span class="op">}</span><span class="op">)</span></span></code></pre></div>
<p><img src="xcms-direct-injection_files/figure-html/feature1-1.png" width="576" style="display: block; margin: auto;"></p>
<p>To access the actual intensity values of each feature in each sample
the <code>featureValue</code> method can be used. The setting
<code>value = "into"</code> tells the function to return the integrated
signal for each peak (one representative peak) per sample.</p>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">feat_vals</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/XCMSnExp-peak-grouping-results.html">featureValues</a></span><span class="op">(</span><span class="va">ham_prep</span>, value <span class="op">=</span> <span class="st">"into"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">feat_vals</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">##      HAM004_641fE_14-11-07--Exp1.extracted.mzML</span></span>
<span><span class="co">## FT01                                         NA</span></span>
<span><span class="co">## FT02                                    4735258</span></span>
<span><span class="co">## FT03                                         NA</span></span>
<span><span class="co">## FT04                                    4158404</span></span>
<span><span class="co">## FT05                                         NA</span></span>
<span><span class="co">## FT06                                    6099006</span></span>
<span><span class="co">##      HAM004_641fE_14-11-07--Exp2.extracted.mzML</span></span>
<span><span class="co">## FT01                                         NA</span></span>
<span><span class="co">## FT02                                    6202418</span></span>
<span><span class="co">## FT03                                         NA</span></span>
<span><span class="co">## FT04                                    5004546</span></span>
<span><span class="co">## FT05                                         NA</span></span>
<span><span class="co">## FT06                                    4950642</span></span>
<span><span class="co">##      HAM005_641fE_14-11-07--Exp1.extracted.mzML</span></span>
<span><span class="co">## FT01                                    4095293</span></span>
<span><span class="co">## FT02                                    4811391</span></span>
<span><span class="co">## FT03                                    2982453</span></span>
<span><span class="co">## FT04                                         NA</span></span>
<span><span class="co">## FT05                                    2872023</span></span>
<span><span class="co">## FT06                                         NA</span></span>
<span><span class="co">##      HAM005_641fE_14-11-07--Exp2.extracted.mzML</span></span>
<span><span class="co">## FT01                                    4804763</span></span>
<span><span class="co">## FT02                                    2581183</span></span>
<span><span class="co">## FT03                                    2268984</span></span>
<span><span class="co">## FT04                                         NA</span></span>
<span><span class="co">## FT05                                    2133219</span></span>
<span><span class="co">## FT06                                         NA</span></span></code></pre>
<p><code>NA</code> is reported for features in samples for which no peak
was identified at the feature’s m/z value. In some instances there might
still be a signal at the feature’s position in the raw data files, but
the peak detection failed to identify a peak. For these cases signal can
be recovered using the <code>fillChromPeaks</code> method that
integrates all raw signal at the feature’s location. If there is no
signal at that location an <code>NA</code> is reported.</p>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">ham_prep</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/fillChromPeaks.html">fillChromPeaks</a></span><span class="op">(</span><span class="va">ham_prep</span>, param <span class="op">=</span> <span class="fu"><a href="../reference/fillChromPeaks.html">FillChromPeaksParam</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="fu"><a href="../reference/XCMSnExp-peak-grouping-results.html">featureValues</a></span><span class="op">(</span><span class="va">ham_prep</span>, value <span class="op">=</span> <span class="st">"into"</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">##      HAM004_641fE_14-11-07--Exp1.extracted.mzML</span></span>
<span><span class="co">## FT01                                   768754.0</span></span>
<span><span class="co">## FT02                                  4735257.5</span></span>
<span><span class="co">## FT03                                   652566.6</span></span>
<span><span class="co">## FT04                                  4158404.5</span></span>
<span><span class="co">## FT05                                   652201.1</span></span>
<span><span class="co">## FT06                                  6099006.3</span></span>
<span><span class="co">##      HAM004_641fE_14-11-07--Exp2.extracted.mzML</span></span>
<span><span class="co">## FT01                                  1230140.4</span></span>
<span><span class="co">## FT02                                  6202417.6</span></span>
<span><span class="co">## FT03                                   374109.9</span></span>
<span><span class="co">## FT04                                  5004546.3</span></span>
<span><span class="co">## FT05                                   403448.4</span></span>
<span><span class="co">## FT06                                  4950641.7</span></span>
<span><span class="co">##      HAM005_641fE_14-11-07--Exp1.extracted.mzML</span></span>
<span><span class="co">## FT01                                    4095293</span></span>
<span><span class="co">## FT02                                    4811391</span></span>
<span><span class="co">## FT03                                    2982453</span></span>
<span><span class="co">## FT04                                    1221031</span></span>
<span><span class="co">## FT05                                    2872023</span></span>
<span><span class="co">## FT06                                    1573988</span></span>
<span><span class="co">##      HAM005_641fE_14-11-07--Exp2.extracted.mzML</span></span>
<span><span class="co">## FT01                                  4804762.5</span></span>
<span><span class="co">## FT02                                  2581183.1</span></span>
<span><span class="co">## FT03                                  2268984.5</span></span>
<span><span class="co">## FT04                                  1241294.4</span></span>
<span><span class="co">## FT05                                  2133219.4</span></span>
<span><span class="co">## FT06                                   977694.5</span></span></code></pre>
</div>
<div class="section level2">
<h2 id="further-analysis">Further analysis<a class="anchor" aria-label="anchor" href="#further-analysis"></a>
</h2>
<p>Further analysis, i.e. detection of features/metabolites with
significantly different abundances, or PCA analyses can be performed on
the feature matrix using functionality from other R packages, such as
<em><a href="https://bioconductor.org/packages/3.17/limma" class="external-link">limma</a></em>.</p>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p></p>
<p>Developed by Steffen Neumann.</p>
</div>

<div class="pkgdown">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.9000.</p>
</div>

      </footer>
</div>

  


  

  </body>
</html>
